{"version":3,"sources":["../.src/src/functions/cast.js"],"names":["asArray","data","defaultArray","undefined","toArray","option","NaN","Array","prototype","slice","call","split","asObject","defaultKey","toNumber","v","d","r","replace","cleanObject","splice","length","Object","keys","forEach","key","clone","target","i","push","Date","setTime","getTime","hasOwnProperty","k","console","error","cloneDeep","l","p","castString","rebaseMatches","matches","text","castFn","props","payload","content","newMatchEntries","castingState","firstIndex","lastIndex","castingStart","cursor","start","open","matchEntries","parentScope","matchesMap","map","matchType","matchExp","firstMatch","a","aPriority","b","bPriority","matchIndex","matchSize","castStart","castEnd","castSize","skipSize","matching","casting","scope","fork","next","needCursor","cursorTo","enter","enterMatches","enterCastFn","exit","more","castPath","__filterDotPath","dotPath","removeFirstDot","indexOf","substr","__filterBlockPath","blockPath","substring","test","parseInt","pathParam","path","stackCount","result","free","datum","dest","_cloneDeep","getKeyWithValue","obj","value","removeValue","detect","array","instance","func","proto","ins","DummyInstance","param","alloc","init","fn","rn","args","apply","syncData","ENTER_HOOK","newDatum","_","assign","UPDATE_HOOK","oldDatum","oldData","newData","getId","options","Error","getIdString","get","e","hooks","oldDataMap","id","ref","newId","findIndex","genDatum","dirty","oldOwnKeys","filter","newOwnKeys","isEqual","pick"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAmBO,MAAMA,UAAU,SAAVA,OAAU,CAASC,IAAT,EAAeC,YAAf,EAAyC;AAAA,QAA1BA,YAA0B;AAA1BA,kBAA0B,GAAXC,SAAW;AAAA;;AAC9D,QAAG,qBAAQF,IAAR,CAAH,EAAkB;AAChB,aAAOA,IAAP;AACD;;AACD,QAAG,oBAAOA,IAAP,CAAH,EAAiB;AACf,aAAO,qBAAQC,YAAR,IAAwBA,YAAxB,GACH,oBAAOA,YAAP,IAAuB,EAAvB,GAA4B,CAACA,YAAD,CADhC;AAED;;AACD,QAAG,OAAOD,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,KAAKG,OAAZ,KAAwB,UAAvD,EAAmE;AACjE,aAAOH,KAAKG,OAAL,EAAP;AACD;;AACD,WAAO,CAACH,IAAD,CAAP;AACD,GAZM;;;;AAcA,MAAMG,UAAU,SAAVA,OAAU,CAASH,IAAT,EAAcI,MAAd,EAAqB;AAC1C,QAAG,OAAOJ,IAAP,KAAgB,WAAhB,IAA+BA,SAAS,IAAxC,IAAgDA,SAASK,GAA5D,EAAkE,OAAO,EAAP;AAClE,QAAG,qBAAQL,IAAR,CAAH,EAAkB,OAAOM,MAAMC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BT,IAA3B,CAAP;AAClB,QAAG,OAAOA,IAAP,KAAgB,QAAhB,IAA4B,OAAOA,KAAKG,OAAZ,KAAwB,UAAvD,EAAmE,OAAOH,KAAKG,OAAL,EAAP;AACnE,QAAG,OAAOH,IAAP,KAAgB,QAAhB,EAA0B,OAAOI,MAAP,KAAkB,QAA/C,EAAyD,OAAOJ,KAAKU,KAAL,CAAWN,MAAX,CAAP;AACzD,WAAO,CAACJ,IAAD,CAAP;AACD,GANM;;;;AAQA,MAAMW,WAAW,SAAXA,QAAW,CAASX,IAAT,EAAeY,UAAf,EAAuC;AAAA,QAAxBA,UAAwB;AAAxBA,gBAAwB,GAAX,SAAW;AAAA;;AAC7D,QAAG,2BAAcZ,IAAd,CAAH,EAAuB;AACrB,aAAOA,IAAP;AACD,KAFD,MAEO;AAAA;;AACL,6BAAUY,UAAV,IAAsBZ,IAAtB;AACD;AACF,GANM;;;;AAQA,MAAMa,WAAW,SAAXA,QAAW,CAASC,CAAT,EAAWC,CAAX,EAAa;AACnC,YAAO,OAAOD,CAAd;AAAkB,WAAK,QAAL;AAAc,eAAOA,CAAP;;AAAS,WAAK,QAAL;AAAc,YAAIE,IAAEF,EAAEG,OAAF,CAAU,WAAV,EAAsB,EAAtB,IAA0B,CAAhC;AAAkC,eAAO,2BAAcD,CAAd,IAAiB,CAAjB,GAAmBA,CAA1B;AAA4B;AAArH;;AACA,YAAO,OAAOD,CAAd;AAAkB,WAAK,QAAL;AAAc,eAAOA,CAAP;;AAAS,WAAK,QAAL;AAAc,YAAIC,IAAED,IAAE,CAAR;AAAU,eAAO,2BAAcC,CAAd,IAAiB,CAAjB,GAAmBA,CAA1B;AAA4B;AAA7F;;AACA,WAAO,CAAP;AACD,GAJM;;;;AAMA,MAAME,cAAc,SAAdA,WAAc,CAASlB,IAAT,EAAc;AACvC,QAAGA,gBAAgBM,KAAnB,EAAyB;AACvBA,YAAMC,SAAN,CAAgBY,MAAhB,CAAuBV,IAAvB,CAA4BT,IAA5B,EAAiC,CAAjC,EAAmCA,KAAKoB,MAAxC;AACD,KAFD,MAEO,IAAG,OAAOpB,IAAP,IAAe,QAAlB,EAA4B;AACjCqB,aAAOC,IAAP,CAAYtB,IAAZ,EAAkBuB,OAAlB,CAA0B,eAAK;AAAE,eAAOvB,KAAKwB,GAAL,CAAP;AAAkB,OAAnD;AACD;;AACD,WAAOxB,IAAP;AACD,GAPM;;;;AASA,MAAMyB,QAAQ,SAARA,KAAQ,CAASC,MAAT,EAAgB;AACnC,YAAO,OAAOA,MAAd;AACA,WAAK,WAAL;AAAkB,WAAK,UAAL;AAAiB,WAAK,SAAL;AAAgB,WAAK,QAAL;AAAe,WAAK,QAAL;AAAe,eAAOA,MAAP;AAAe;;AAChG,WAAK,QAAL;AACE,YAAGA,WAAW,IAAd,EAAoB,OAAOA,MAAP;;AAEpB,YAAG,qBAAQA,MAAR,CAAH,EAAmB;AACjB,cAAIV,KAAE,EAAN;;AACA,eAAI,IAAIW,IAAE,CAAN,EAAQP,SAAOM,OAAON,MAA1B,EAAiCO,IAAEP,MAAnC,EAA0CO,GAA1C;AAA8CX,eAAEY,IAAF,CAAOF,OAAOC,CAAP,CAAP;AAA9C;;AACA,iBAAOX,EAAP;AACD;;AAED,YAAG,CAAC,2BAAcU,MAAd,CAAJ,EAA0B;AACxB,cAAGA,kBAAkBG,IAArB,EAA0B;AACxB,gBAAIb,MAAE,IAAIa,IAAJ,EAAN;;AACAb,gBAAEc,OAAF,CAAUJ,OAAOK,OAAP,EAAV;;AACA,mBAAOf,GAAP;AACD;;AACD,iBAAOU,MAAP;AACD;;AAED,YAAIV,IAAE,EAAN;AAEAK,eAAOC,IAAP,CAAYI,MAAZ,EAAoBH,OAApB,CAA4B,aAAG;AAC7B,cAAGG,OAAOM,cAAP,CAAsBC,CAAtB,CAAH,EAA6BjB,EAAEiB,CAAF,IAAKP,OAAOO,CAAP,CAAL;AAC9B,SAFD;AAGA,eAAOjB,CAAP;AACA;;AACF;AACEkB,gBAAQC,KAAR,CAAc,iCAAd,EAAgDT,MAAhD;AACA,eAAOA,MAAP;AACA;AA9BF;AAgCD,GAjCM;;;;AAmCA,MAAMU,YAAY,SAAZA,SAAY,CAASV,MAAT,EAAgB;AACvC,QAAIX,CAAJ;;AACA,QAAG,OAAOW,MAAP,KAAkB,QAArB,EAA8B;AAC7B,UAAG,qBAAQA,MAAR,CAAH,EAAoB;AACnB,YAAG,CAAC,qBAAQX,CAAR,CAAJ,EAAgB;AAAEA,cAAI,EAAJ;AAAQ;;AAAA;;AAC1B,aAAK,IAAIY,IAAE,CAAN,EAAQU,IAAEX,OAAON,MAAtB,EAA6BO,IAAEU,CAA/B,EAAiCV,GAAjC;AAAsCZ,YAAEa,IAAF,CAAU,OAAOF,OAAOC,CAAP,CAAP,KAAqB,QAArB,IAAiCD,OAAOC,CAAP,MAAc,IAAhD,GAAyDF,MAAMC,OAAOC,CAAP,CAAN,CAAzD,GAA4ED,OAAOC,CAAP,CAArF;AAAtC;;AACA,eAAOZ,CAAP;AACA,OAJD,MAIO;AACNA,YAAI,EAAJ;AACEM,eAAOC,IAAP,CAAYI,MAAZ,EAAoBH,OAApB,CAA4B,aAAG;AAC5B,iBAAOG,OAAOY,CAAP,CAAP,KAAqB,QAArB,IAAiCZ,OAAOY,CAAP,MAAc,IAA/C,IAAuDvB,EAAEuB,CAAF,CAAxD,GAAgEb,MAAMC,OAAOY,CAAP,CAAN,EAAgBvB,EAAEuB,CAAF,CAAhB,CAAhE,GAAwFvB,EAAEuB,CAAF,IAAOZ,OAAOY,CAAP,CAA/F;AACD,SAFD;AAGF,eAAOvB,CAAP;AACA;AACD,KAZD,MAYO;AACLU,YAAMC,MAAN;AACD;AACF,GAjBM,C,CAmBP;;;;;AACO,MAAMa,aAAc,YAAU;AACnC,QAAMC,gBAAgB,SAAhBA,aAAgB;AAAA,aAAS,qBAAQzC,QAAQ0C,OAAR,CAAR,CAAT;AAAA,KAAtB;;AACA,WAAO,UAASC,IAAT,EAAcD,OAAd,EAAsBE,MAAtB,EAA6BC,KAA7B,EAAmC;AACxC,UAAMC,UAAU;AACdC,iBAAQJ,IADM;AAEdE;AAFc,OAAhB;AAKA,UAAMG,kBAAkBP,cAAcC,OAAd,CAAxB;AAEA,UAAMO,eAAe;AACnBC,oBAAW,CADQ;AAEnBC,mBAAUR,KAAKtB,MAFI;AAGnB+B,sBAAa,CAHM;AAInBC,gBAAO;AAJY,OAArB;;AAOA,UAAG,OAAOR,KAAP,KAAiB,QAAjB,IAA6B,sBAASA,MAAMS,KAAf,CAAhC,EAAsD;AACpDL,qBAAaG,YAAb,GAA4BP,MAAMS,KAAlC;AACAL,qBAAaI,MAAb,GAA4BR,MAAMS,KAAlC;AACD;;AAED,UAAMC,OAAO,SAAPA,IAAO,QAA6G;AAAA,uCAAlGN,YAAkG;AAAA,YAAnFC,UAAmF,sBAAnFA,UAAmF;AAAA,YAAvEC,SAAuE,sBAAvEA,SAAuE;AAAA,YAA5DC,YAA4D,sBAA5DA,YAA4D;AAAA,YAA9CC,MAA8C,sBAA9CA,MAA8C;AAAA,YAApCG,YAAoC,SAApCA,YAAoC;AAAA,YAAtBZ,MAAsB,SAAtBA,MAAsB;AAAA,YAAda,WAAc,SAAdA,WAAc;;AAExH,YAAGJ,UAAQF,SAAX,EAAqB;AACnB,iBAAO,KAAP;AACD,SAJuH,CAMxH;;;AACA,YAAMO,aAAaF,aAAaG,GAAb,CAAiB;AAAA,cAAEC,SAAF;AAAA,cAAaC,QAAb;AAAA,iBAA0B,CAAC,0BAAYlB,IAAZ,EAAiBkB,QAAjB,EAA0BR,MAA1B,CAAD,EAAoCO,SAApC,EAA+CC,QAA/C,CAA1B;AAAA,SAAjB,CAAnB;AACA,YAAIC,aAAe,kBAAIJ,UAAJ,EAAe;AAAA,cAAEK,CAAF;AAAA,cAAIC,SAAJ;AAAA,cAAgBC,CAAhB;AAAA,cAAkBC,SAAlB;AAAA,iBAChCH,EAAE,CAAF,IAAK,CAAL,GAAO,IAAP,GACAE,EAAE,CAAF,IAAK,CAAL,GAAO,KAAP,GACAF,EAAE,CAAF,KAAME,EAAE,CAAF,CAAN,GAAWD,YAAUE,SAArB,GAA+BH,EAAE,CAAF,IAAKE,EAAE,CAAF,CAHJ;AAAA,SAAf,CAAnB,CARwH,CAcxH;;AACA,YAAG,CAACH,UAAJ,EAAe;AAAE,iBAAO,KAAP;AAAe,SAfwF,CAiBxH;;;AACA,YAAGA,WAAW,CAAX,EAAc,CAAd,MAAqB,CAAC,CAAzB,EAA2B;AACzBA,uBAAa,CAAC,CAAC,CAAC,CAAF,EAAK,CAAL,CAAD,EAAU,CAAC,CAAX,EAAc,IAAd,CAAb;AACD,SApBuH,CAsBxH;;;AAtBwH,0BAuB/DA,UAvB+D;AAAA;AAAA,YAuB/GK,UAvB+G;AAAA,YAuBnGC,SAvBmG;AAAA,YAuBtFR,SAvBsF;AAAA,YAuB3EC,QAvB2E;AAwBxH,YAAMQ,YAAYjB,YAAlB;AACA,YAAMkB,UAAYV,cAAc,CAAC,CAAf,GAAmBT,SAAnB,GAAgCgB,aAAaC,SAA/D;AACA,YAAMG,WAAYD,UAAUD,SAA5B;AACA,YAAMG,WAAYD,WAAWH,SAA7B,CA3BwH,CA6BxH;;AACA,YAAMK,WAAW;AACfb,8BADe;AAEfC,4BAFe;AAGfM,gCAHe;AAIfC,8BAJe;AAKfI;AALe,SAAjB;AAOA,YAAME,UAAU;AACdxB,gCADc;AAEdC,8BAFc;AAGdkB,8BAHc;AAIdC,0BAJc;AAKdC;AALc,SAAhB;AAOA,YAAMI,QAAQ;AACZC,cADY,gBACNpB,YADM,EACOZ,MADP,EACc;AACxB,gBAAMI,kBAAkBP,cAAcC,OAAd,CAAxB;AACAa,iBAAK;AACHN,4BAAa;AACXC,4BAAauB,SAASN,UADX;AAEXhB,2BAAasB,SAASN,UAAT,GAAsBC,SAFxB;AAGXhB,8BAAaqB,SAASN,UAHX;AAIXd,wBAAaoB,SAASN;AAJX,eADV;AAOHX,4BAAaR,eAPV;AAQHJ,4BARG;AASHa;AATG,aAAL;AAWD,WAdW;AAeZoB,cAfY,gBAeNC,UAfM,EAeK;AACf,gBAAMC,WAAW,sBAASD,UAAT,IAAuBA,UAAvB,GAAoCJ,QAAQJ,OAA7D;AACAf,iBAAK;AACHN,4BAAa;AACXC,sCADW;AAEXC,oCAFW;AAGXC,8BAAa2B,QAHF;AAIX1B,wBAAa0B;AAJF,eADV;AAOHvB,wCAPG;AAQHZ,4BARG;AASHa;AATG,aAAL;AAWD,WA5BW;AA6BZuB,eA7BY,iBA6BLC,YA7BK,EA6BQC,WA7BR,EA6BoB;AAC9B3B,iBAAK;AACHN,4BAAa;AACXC,sCADW;AAEXC,oCAFW;AAGXC,8BAAaqB,SAASN,UAHX;AAIXd,wBAAaoB,SAASN;AAJX,eADV;AAOHX,4BAAaf,cAAcwC,YAAd,CAPV;AAQHrC,sBAAOsC,WARJ;AASHzB,2BAAY;AACVoB,sBAAKF,MAAME;AADD;AATT,aAAL;AAaD,WA3CW;AA4CZM,cA5CY,gBA4CNL,UA5CM,EA4CK;AACfrB,2BAAeA,YAAYoB,IAAZ,CAAiB,sBAASC,UAAT,IAAuBA,UAAvB,GAAoCJ,QAAQJ,OAA7D,CAAf;AACD,WA9CW;AA+CZc,cA/CY,kBA+CL;AACL7B,iBAAK;AACHN,4BAAa;AACXC,sCADW;AAEXC,oCAFW;AAGXC,8BAAaiB,SAHF;AAIXhB,wBAAaqB,QAAQJ;AAJV,eADV;AAOHd,wCAPG;AAQHZ,4BARG;AASHa;AATG,aAAL;AAWD;AA3DW,SAAd;AA8DAb,iCACKE,OADL,EAEK2B,QAFL,EAGKC,OAHL,EAIKC,KAJL;AAOA,eAAO,IAAP;AACD,OAlHD;;AAoHApB,WAAK;AACHN,kCADG;AAEHO,sBAAaR,eAFV;AAGHJ;AAHG,OAAL;AAMA,aAAOE,OAAP;AACD,KA/ID;AAgJD,GAlJ0B,EAApB;;;;AAoJA,MAAMuC,WAAY,YAAU;AAEjC,QAAMC,kBAAkB,SAAlBA,eAAkB,CAACC,OAAD,EAASC,cAAT;AAAA,aAA0BA,kBAAkBD,QAAQE,OAAR,CAAgB,GAAhB,MAAyB,CAA3C,GAA+CF,QAAQG,MAAR,CAAe,CAAf,CAA/C,GAAmEH,OAA7F;AAAA,KAAxB;;AACA,QAAMI,oBAAoB,SAApBA,iBAAoB,CAACC,SAAD,EAAa;AACrC;AACAA,kBAAYA,UAAUC,SAAV,CAAoB,CAApB,EAAsBD,UAAUvE,MAAV,GAAiB,CAAvC,CAAZ,CAFqC,CAIrC;;AACA,UAAG,WAAWyE,IAAX,CAAgBF,SAAhB,CAAH,EAA8B;AAC5B,eAAOG,SAASH,SAAT,EAAmB,EAAnB,CAAP;AACD,OAPoC,CASrC;;;AACA,UAAG,WAAWE,IAAX,CAAgBF,SAAhB,KAA8B,WAAWE,IAAX,CAAgBF,SAAhB,CAAjC,EAA4D;AAC1DA,oBAAYA,UAAUC,SAAV,CAAoB,CAApB,EAAsBD,UAAUvE,MAAV,GAAiB,CAAvC,CAAZ;AACD;;AACD,aAAOuE,SAAP;AACD,KAdD;;AAgBA,WAAO,UAASI,SAAT,EAAmB;AACxB,UAAG,qBAAQA,SAAR,CAAH,EAAsB;AACpB,eAAOA,SAAP;AACD;;AAED,UAAG,wBAAWA,SAAX,CAAH,EAAyB;AAEvB,YAAG,sBAASA,SAAT,CAAH,EAAuB;AACrB,iBAAO,CAACA,SAAD,CAAP;AACD;;AAED,YAAG,OAAOA,SAAP,KAAqB,QAAxB,EAAiC;AAAA,4BACGxD,WAAWwD,SAAX,EAAqB,CAAC,GAAD,EAAK,GAAL,CAArB,EAA+B,iBAE7D;AAAA,gBADFjD,OACE,SADFA,OACE;AAAA,gBADekD,IACf,SADOpD,KACP,CADeoD,IACf;AAAA,gBADuBpC,QACvB,SADuBA,QACvB;AAAA,gBADiCQ,SACjC,SADiCA,SACjC;AAAA,gBAD4CC,OAC5C,SAD4CA,OAC5C;AAAA,gBADqDC,QACrD,SADqDA,QACrD;AAAA,gBAD+DC,QAC/D,SAD+DA,QAC/D;AAAA,gBADyEQ,KACzE,SADyEA,KACzE;AAAA,gBADgFH,IAChF,SADgFA,IAChF;;AACF,gBAAGhB,aAAa,GAAhB,EAAoB;AAClBW,0BAAYyB,KAAKpE,IAAL,CAAWkB,QAAQ2C,MAAR,CAAerB,SAAf,EAA0BG,QAA1B,CAAX,CAAZ;AACAK;AACD;;AACD,gBAAGhB,aAAa,GAAhB,EAAoB;AAClB,kBAAIqC,aAAa,CAAjB;;AAEA,kBAAG1B,QAAH,EAAY;AACVyB,qBAAKpE,IAAL,CAAWyD,gBAAgBvC,QAAQ2C,MAAR,CAAerB,SAAf,EAA0BG,QAA1B,CAAhB,EAAoDH,cAAc,CAAlE,CAAX;AACD;;AAEDW,oBAAM,CAAC,GAAD,EAAK,GAAL,CAAN,EAAgB,iBAAgD;AAAA,oBAA7CnB,QAA6C,SAA7CA,QAA6C;AAAA,oBAAnCQ,SAAmC,SAAnCA,SAAmC;AAAA,oBAAxBC,OAAwB,SAAxBA,OAAwB;AAAA,oBAAfc,IAAe,SAAfA,IAAe;AAAA,oBAATD,IAAS,SAATA,IAAS;AAC9D,oBAAGtB,aAAa,GAAhB,EAAqBqC;AACrB,oBAAGrC,aAAa,GAAhB,EAAqBqC;AACrB,oBAAGrC,aAAa,IAAhB,EAAsB;;AACtB,oBAAGqC,eAAe,CAAlB,EAAoB;AAClBD,uBAAKpE,IAAL,CAAW8D,kBAAmB5C,QAAQ8C,SAAR,CAAkBxB,SAAlB,EAA6BC,OAA7B,CAAnB,CAAX;AACAa;AACD,iBAHD,MAGO;AACLC;AACD;AACF,eAVD;AAWD;;AACD,gBAAGvB,aAAa,IAAhB,EAAqB;AACnBoC,mBAAKpE,IAAL,CAAWyD,gBAAgBvC,QAAQ2C,MAAR,CAAerB,SAAf,EAA0BC,OAA1B,CAAhB,EAAmDD,cAAc,CAAjE,CAAX;AACD;AACF,WA7BiC,EA6BhC;AAAE4B,kBAAK;AAAP,WA7BgC,CADH;AAAA,cACVE,MADU,eACvBtD,KADuB,CACfoD,IADe;;AAgC/B,iBAAOE,MAAP;AACD;AACF;;AACD,aAAO,EAAP;AACD,KA/CD;AAgDD,GAnEwB,EAAlB;;;;AAsEA,MAAMC,OAAO,SAAPA,IAAO,CAASC,KAAT,EAAe;AACjC,QAAMC,OAAO,EAAb;AACAhF,WAAOC,IAAP,CAAY8E,KAAZ,EAAmB7E,OAAnB,CAA2B,eAAK;AAC9B,UAAG,CAAC,MAAMsE,IAAN,CAAWrE,GAAX,CAAJ,EAAoB;AAClB6E,aAAK7E,GAAL,IAAY8E,WAAWF,MAAM5E,GAAN,CAAX,CAAZ;AACD;AACF,KAJD;AAKA,WAAO6E,IAAP;AACD,GARM;;;;AAUP,MAAME,kBAAkB,SAAlBA,eAAkB,CAASC,GAAT,EAAaC,KAAb,EAAmB;AACzC,QAAG,qBAAQD,GAAR,CAAH,EAAgB;AACd,WAAI,IAAI7E,IAAE,CAAN,EAAQU,IAAEmE,IAAIpF,MAAlB,EAAyBO,IAAEU,CAA3B,EAA6BV,GAA7B;AAAkC,YAAG6E,IAAI7E,CAAJ,MAAS8E,KAAZ,EAAmB,OAAO9E,CAAP;AAArD;AACD;;AACD,QAAG,sBAAS6E,GAAT,CAAH,EAAiB;AACf,WAAI,IAAIhF,GAAR,IAAegF,GAAf;AAAoB,YAAGA,IAAIhF,GAAJ,MAAWiF,KAAd,EAAqB,OAAOjF,GAAP;AAAzC;AACD;;AACD,WAAOtB,SAAP;AACD,GARD;;AAUO,MAAMwG,cAAc,SAAdA,WAAc,CAASF,GAAT,EAAaC,KAAb,EAAmB;AAC5C,QAAIE,SAAS,IAAb;AACA,QAAIC,QAAS,qBAAQJ,GAAR,CAAb;;AAEA,WAAMG,MAAN,EAAc;AACZ,UAAInF,MAAM+E,gBAAgBC,GAAhB,EAAoBC,KAApB,CAAV;;AACA,UAAG,OAAOjF,GAAP,KAAe,WAAlB,EAA8B;AAC5BmF,iBAAS,KAAT;AACD,OAFD,MAEO;AACL,YAAGC,KAAH,EAAS;AACPJ,cAAIrF,MAAJ,CAAWK,GAAX,EAAe,CAAf;AACD,SAFD,MAEO;AACL,iBAAOgF,IAAIhF,GAAJ,CAAP;AACD;AACF;AACF;;AAED,WAAOgF,GAAP;AACD,GAlBM;;;;AAoBA,MAAMK,WAAW,SAAXA,QAAW,CAASC,IAAT,EAAcC,KAAd,EAAoB;AAC1C,QAAIC,GAAJ;AAAA,QAAQC,gBAAc,SAAdA,aAAc,CAASC,KAAT,EAAe;AAAE,UAAG,OAAOA,KAAP,KAAiB,QAApB,EAA8B,KAAI,IAAIjF,CAAR,IAAaiF,KAAb;AAAoB,aAAKjF,CAAL,IAAUiF,MAAMjF,CAAN,CAAV;AAApB;AAAyC,KAA9G;;AACA,QAAG,OAAO6E,IAAP,IAAe,QAAlB,EAA2B;AACzB,UAAG,OAAOC,KAAP,KAAiB,QAApB,EAA8BE,cAAc1G,SAAd,GAA0BwG,KAA1B;AAC9BC,YAAM,IAAIC,aAAJ,CAAkBH,IAAlB,CAAN;AACD;;AACD,QAAG,OAAOA,IAAP,IAAe,UAAlB,EAA6B;AAC3B,UAAG,OAAOC,KAAP,KAAiB,QAApB,EAA8BD,KAAKvG,SAAL,GAAiBwG,KAAjB;AAC9BC,YAAO,IAAIF,IAAJ,EAAP;AACD;;AACD,WAAOE,GAAP;AACD,GAXM;;;;AAaA,MAAMG,QAAQ,SAARA,KAAQ,CAASC,IAAT,EAAe;AAClC,QAAIC,KAAKD,MAAT;;AACA,QAAME,KAAK,SAALA,EAAK,GAAkB;AAAA,wCAANC,IAAM;AAANA,YAAM;AAAA;;AAC3B,aAAOF,GAAGG,KAAH,CAAS,IAAT,EAAeD,IAAf,CAAP;AACD,KAFD;;AAGAD,OAAG,OAAH,IAAc,YAAW;AAAED,WAAKD,KAAKE,EAAL,EAASA,EAAT,CAAL;AAAoB,KAA/C;;AACAA,OAAG,cAAH,IAAqBD,EAArB;AACA,WAAOC,EAAP;AACD,GARM;;;;AAUP,MAAMG,WAAY,YAAU;AAC1B,QAAMC,aAAc,SAAdA,UAAc,CAACC,QAAD;AAAA,aAAYC,EAAEC,MAAF,CAAS,EAAT,EAAaF,QAAb,CAAZ;AAAA,KAApB;;AACA,QAAMG,cAAc,SAAdA,WAAc,CAACC,QAAD,EAAWJ,QAAX;AAAA,aAAsBC,EAAEC,MAAF,CAAS,EAAT,EAAaE,QAAb,EAAuBJ,QAAvB,CAAtB;AAAA,KAApB;;AAEA,WAAO,UAASK,OAAT,EAAkBC,OAAlB,EAA2BC,KAA3B,EAAkCC,OAAlC,EAA2C;AAChD,UAAG,CAAC,kBAAkBtC,IAAlB,CAAuB,OAAOqC,KAA9B,CAAJ,EAA0C,MAAM,IAAIE,KAAJ,CAAU,qBAAV,CAAN;;AAE1C,UAAG,OAAOF,KAAP,KAAiB,QAApB,EAA8B;AAC5B,YAAMG,cAAcH,KAApB;;AACAA,gBAAQ;AAAA,iBAAGN,EAAEU,GAAF,CAAMC,CAAN,EAASF,WAAT,CAAH;AAAA,SAAR;AACD;;AAEDL,gBAAUjI,QAAQiI,OAAR,CAAV;AACAC,gBAAUlI,QAAQkI,OAAR,CAAV;AAEA,UAAM/B,SAAS,EAAf;AACA,UAAMsC,QAAS7H,SAASwH,OAAT,EAAiB,WAAjB,CAAf;;AAEA,UAAG,OAAOK,MAAM,OAAN,CAAP,KAA0B,UAA7B,EAAwC;AACtCA,cAAM,OAAN,IAAiBd,UAAjB;AACD;;AAED,UAAG,OAAOc,MAAM,QAAN,CAAP,KAA2B,UAA9B,EAAyC;AACvCA,cAAM,QAAN,IAAkBV,WAAlB;AACD;;AAED,UAAMW,aAAab,EAAElE,GAAF,CAAMsE,OAAN,EAAe,aAAG;AACnC,eAAO;AAAEU,cAAIR,MAAMK,CAAN,CAAN;AAAgBI,eAAKJ;AAArB,SAAP;AACD,OAFkB,CAAnB;;AAKAxI,cAAQkI,OAAR,EAAiB1G,OAAjB,CAAyB,UAACoG,QAAD,EAAWhG,CAAX,EAAe;AACtC,YAAMiH,QAAQV,MAAMP,QAAN,CAAd;;AACA,YAAII,WAAWH,EAAEU,GAAF,CAAMG,WAAWb,EAAEiB,SAAF,CAAYJ,UAAZ,EAAwB;AAAA,iBAAGF,EAAEG,EAAF,KAASE,KAAZ;AAAA,SAAxB,CAAX,CAAN,EAA8D,KAA9D,CAAf;;AACA,YAAIE,QAAJ;AACA,YAAIC,QAAQ,KAAZ;;AAEA,YAAGhB,QAAH,EAAa;AACX;AACA,cAAG,OAAOA,QAAP,KAAoB,OAAOJ,QAA9B,EAAwC;AACtCoB,oBAAQ,KAAR;AACD,WAFD,MAEO;AAAE;AACP,gBAAMC,aAAa3H,OAAOC,IAAP,CAAYyG,QAAZ,EAAsBkB,MAAtB,CAA6B;AAAA,qBAAK,EAAEzH,IAAIgE,OAAJ,CAAY,GAAZ,MAAqB,CAAvB,CAAL;AAAA,aAA7B,CAAnB;AACA,gBAAM0D,aAAa7H,OAAOC,IAAP,CAAYqG,QAAZ,EAAsBsB,MAAtB,CAA6B;AAAA,qBAAK,EAAEzH,IAAIgE,OAAJ,CAAY,GAAZ,MAAqB,CAAvB,CAAL;AAAA,aAA7B,CAAnB,CAFK,CAIL;;AACA,gBAAGoC,EAAEuB,OAAF,CAAUH,UAAV,EAAsBE,UAAtB,CAAH,EAAsC;AACpCH,sBAAQ,CAACnB,EAAEuB,OAAF,CAAUvB,EAAEwB,IAAF,CAAOrB,QAAP,EAAiBiB,UAAjB,CAAV,EAAwCpB,EAAEwB,IAAF,CAAOzB,QAAP,EAAiBuB,UAAjB,CAAxC,CAAT;AACD,aAFD,MAEO;AACLH,sBAAQ,IAAR;AACD;AACF;;AAED,cAAG,OAAOP,MAAM,cAAN,CAAP,KAAiC,UAApC,EAA+C;AAC7C,gBAAGA,MAAM,cAAN,EAAsBT,QAAtB,EAAgCJ,QAAhC,MAA8C,KAAjD,EAAuD;AACrD;AACD;AACF;;AAEDmB,qBAAWN,MAAM,QAAN,EAAgBT,QAAhB,EAA0BJ,QAA1B,CAAX;;AAEA,cAAG,OAAOa,MAAM,aAAN,CAAP,KAAgC,UAAnC,EAA8C;AAC5CM,uBAAWN,MAAM,aAAN,EAAqBM,QAArB,EAA+Bf,QAA/B,EAAyCJ,QAAzC,CAAX;AACD;AACF,SA3BD,MA2BO;AACL,cAAG,OAAOa,MAAM,aAAN,CAAP,KAAgC,UAAnC,EAA8C;AAC5C,gBAAGA,MAAM,aAAN,EAAqBb,QAArB,MAAmC,KAAtC,EAA4C;AAC1C;AACD;AACF;;AAEDmB,qBAAWN,MAAM,OAAN,EAAeb,QAAf,CAAX;;AAEA,cAAG,OAAOa,MAAM,YAAN,CAAP,KAA+B,UAAlC,EAA6C;AAC3CM,uBAAWN,MAAM,YAAN,EAAoBM,QAApB,EAA8BnB,QAA9B,CAAX;AACD;AACF;;AAED,YAAG,OAAOa,MAAM,WAAN,CAAP,KAA8B,UAAjC,EAA6C;AAC3CA,gBAAM,WAAN,EAAmBM,QAAnB,EAA6BnH,CAA7B,EAAgCoH,KAAhC;AACD;;AAED7C,eAAOtE,IAAP,CAAYkH,QAAZ;AACD,OApDD;AAsDA,aAAO5C,MAAP;AACD,KAlFD;AAmFD,GAvFiB,EAAlB","sourcesContent":["import {\n  isArray,\n  likeString,\n  isNone,\n  isAbsoluteNaN,\n  isNumber,\n  isPlainObject,\n  isObject\n} from './isLike'\n\nimport {\n  matchString,\n  top\n} from './reducer'\n\nimport {\n  entries\n} from './shadow'\n\nexport const asArray = function(data, defaultArray = undefined) {\n  if(isArray(data)) {\n    return data;\n  }\n  if(isNone(data)) {\n    return isArray(defaultArray) ? defaultArray\n      : isNone(defaultArray) ? [] : [defaultArray];\n  }\n  if(typeof data === \"object\" && typeof data.toArray === \"function\") {\n    return data.toArray();\n  }\n  return [data];\n};\n\nexport const toArray = function(data,option){\n  if(typeof data === \"undefined\" || data === null || data === NaN ) return [];\n  if(isArray(data)) return Array.prototype.slice.call(data);\n  if(typeof data === \"object\" && typeof data.toArray === \"function\") return data.toArray();\n  if(typeof data === \"string\", typeof option === \"string\") return data.split(option);\n  return [data];\n}\n\nexport const asObject = function(data, defaultKey = \"default\") {\n  if(isPlainObject(data)){\n    return data;\n  } else {\n    return { [defaultKey]:data }\n  }\n};\n\nexport const toNumber = function(v,d){\n  switch(typeof v){ case \"number\":return v;case \"string\":var r=v.replace(/[^.\\d\\-]/g,\"\")*1;return isAbsoluteNaN(r)?0:r;break; }\n  switch(typeof d){ case \"number\":return d;case \"string\":var r=d*1;return isAbsoluteNaN(r)?0:r;break; }\n  return 0;\n}\n\nexport const cleanObject = function(data){\n  if(data instanceof Array){\n    Array.prototype.splice.call(data,0,data.length)\n  } else if(typeof data == \"object\") {\n    Object.keys(data).forEach(key=>{ delete data[key] })\n  }\n  return data\n}\n\nexport const clone = function(target){\n  switch(typeof target){\n  case \"undefined\": case \"function\": case \"boolean\": case \"number\": case \"string\": return target; break;\n  case \"object\":\n    if(target === null) return target;\n    \n    if(isArray(target)){\n      let r=[];\n      for(let i=0,length=target.length;i<length;i++)r.push(target[i]);\n      return r;\n    }\n    \n    if(!isPlainObject(target)){\n      if(target instanceof Date){\n        let r=new Date();\n        r.setTime(target.getTime());\n        return r;\n      }\n      return target;\n    }\n    \n    let r={};\n    \n    Object.keys(target).forEach(k=>{\n      if(target.hasOwnProperty(k)) r[k]=target[k];\n    });\n    return r;\n    break;\n  default : \n    console.error(\"clone::copy failed : target => \",target);\n    return target; \n    break\n  }\n}\n\nexport const cloneDeep = function(target){\n  var d;\n  if(typeof target === \"object\"){\n  \tif(isArray(target)) {\n  \t\tif(!isArray(d)) { d = [] };\n  \t\tfor (var i=0,l=target.length;i<l;i++) d.push( ((typeof target[i] === \"object\" && target[i] !== null ) ? clone(target[i]) : target[i]) )\n  \t\treturn d;\n  \t} else {\n  \t\td = {}\n      Object.keys(target).forEach(p=>{\n        (typeof target[p] === \"object\" && target[p] !== null && d[p]) ? clone(target[p],d[p]) : d[p] = target[p];\n      })\n  \t\treturn d;\n  \t}\n  } else {\n    clone(target);\n  }\n};\n\n//cast.castString.spec.js\nexport const castString = (function(){\n  const rebaseMatches = matches=>entries(asArray(matches));\n  return function(text,matches,castFn,props){\n    const payload = {\n      content:text,\n      props\n    };\n  \n    const newMatchEntries = rebaseMatches(matches);\n  \n    const castingState = {\n      firstIndex:0,\n      lastIndex:text.length,\n      castingStart:0,\n      cursor:0\n    };\n    \n    if(typeof props === \"object\" && isNumber(props.start)){\n      castingState.castingStart = props.start;\n      castingState.cursor       = props.start;\n    }\n\n    const open = function({ castingState:{ firstIndex, lastIndex, castingStart, cursor }, matchEntries, castFn, parentScope }){\n      \n      if(cursor>=lastIndex){\n        return false;\n      }\n      \n      //find match\n      const matchesMap = matchEntries.map(([matchType, matchExp])=>([matchString(text,matchExp,cursor), matchType, matchExp]));\n      let firstMatch   = top(matchesMap,([a,aPriority],[b,bPriority])=>(\n        a[0]<0?true:\n        b[0]<0?false:\n        a[0]==b[0]?aPriority<bPriority:a[0]>b[0]\n      ));\n      \n      // top match is not exsist\n      if(!firstMatch){ return false; }\n      \n      // unmatched\n      if(firstMatch[0][0] === -1){\n        firstMatch = [[-1, 0], -1, null];\n      }\n\n      //next variant\n      const [[ matchIndex, matchSize ], matchType, matchExp] = firstMatch;\n      const castStart = castingStart;\n      const castEnd   = matchType === -1 ? lastIndex : (matchIndex + matchSize);\n      const castSize  = castEnd - castStart;\n      const skipSize  = castSize - matchSize;\n      \n      //next params\n      const matching = { \n        matchType, \n        matchExp,\n        matchIndex,\n        matchSize,\n        skipSize\n      };\n      const casting = {\n        firstIndex,\n        lastIndex,\n        castStart,\n        castEnd,\n        castSize\n      };\n      const scope = {\n        fork (matchEntries,castFn){\n          const newMatchEntries = rebaseMatches(matches);\n          open({\n            castingState:{\n              firstIndex  :matching.matchIndex,\n              lastIndex   :matching.matchIndex + matchSize,\n              castingStart:matching.matchIndex,\n              cursor      :matching.matchIndex\n            }, \n            matchEntries:newMatchEntries,\n            castFn,\n            parentScope\n          });\n        },\n        next (needCursor){\n          const cursorTo = isNumber(needCursor) ? needCursor : casting.castEnd;\n          open({\n            castingState:{\n              firstIndex  ,\n              lastIndex   ,\n              castingStart:cursorTo,\n              cursor      :cursorTo\n            },\n            matchEntries,\n            castFn,\n            parentScope\n          });\n        },\n        enter (enterMatches,enterCastFn){\n          open({\n            castingState:{\n              firstIndex  ,\n              lastIndex   ,\n              castingStart:matching.matchIndex,\n              cursor      :matching.matchIndex\n            },\n            matchEntries:rebaseMatches(enterMatches),\n            castFn:enterCastFn,\n            parentScope:{\n              next:scope.next\n            }\n          });\n        },\n        exit (needCursor){\n          parentScope && parentScope.next(isNumber(needCursor) ? needCursor : casting.castEnd);\n        },\n        more (){\n          open({\n            castingState:{\n              firstIndex  ,\n              lastIndex   ,\n              castingStart:castStart,\n              cursor      :casting.castEnd\n            },\n            matchEntries,\n            castFn,\n            parentScope\n          });\n        }\n      };\n      \n      castFn({\n        ...payload,\n        ...matching,\n        ...casting,\n        ...scope\n      });\n      \n      return true;\n    };\n    \n    open({\n      castingState,\n      matchEntries:newMatchEntries,\n      castFn\n    });\n  \n    return payload;\n  };\n}());\n\nexport const castPath = (function(){\n  \n  const __filterDotPath = (dotPath,removeFirstDot)=>removeFirstDot && dotPath.indexOf(\".\") === 0 ? dotPath.substr(1) : dotPath;\n  const __filterBlockPath = (blockPath)=>{\n    //remove []\n    blockPath = blockPath.substring(1,blockPath.length-1);\n    \n    //interger\n    if(/^[0-9]+$/.test(blockPath)){\n      return parseInt(blockPath,10);\n    }\n    \n    //remove ''\n    if(/^\\'.*\\'$/.test(blockPath) || /^\\\".*\\\"$/.test(blockPath)){\n      blockPath = blockPath.substring(1,blockPath.length-1);\n    }\n    return blockPath;\n  }\n\n  return function(pathParam){\n    if(isArray(pathParam)){\n      return pathParam;\n    }\n  \n    if(likeString(pathParam)){\n    \n      if(isNumber(pathParam)){\n        return [pathParam]\n      }\n    \n      if(typeof pathParam === \"string\"){\n        const { props:{ path:result } } = castString(pathParam,[\".\",\"[\"],({\n          content, props:{ path }, matchExp, castStart, castEnd, castSize, skipSize, enter, next\n        })=>{\n          if(matchExp === \".\"){\n            skipSize && path.push( content.substr(castStart, skipSize) )\n            next();\n          }\n          if(matchExp === \"[\"){\n            let stackCount = 0;\n          \n            if(skipSize){\n              path.push( __filterDotPath(content.substr(castStart, skipSize),castStart !== 0) );\n            }\n          \n            enter([\"[\",\"]\"],({ matchExp, castStart, castEnd, more, exit })=>{\n              if(matchExp === \"[\") stackCount++;\n              if(matchExp === \"]\") stackCount--;\n              if(matchExp === null) return;\n              if(stackCount === 0){\n                path.push( __filterBlockPath( content.substring(castStart, castEnd) ) );\n                exit();\n              } else {\n                more();\n              }\n            });\n          }\n          if(matchExp === null){\n            path.push( __filterDotPath(content.substr(castStart, castEnd),castStart !== 0) );\n          }\n        },{ path:[] })\n      \n        return result;\n      }\n    }\n    return [];\n  };\n}())\n  \n\nexport const free = function(datum){\n  const dest = {}\n  Object.keys(datum).forEach(key=>{\n    if(!/^\\$/.test(key)){\n      dest[key] = _cloneDeep(datum[key])\n    }\n  });\n  return dest;\n}\n\nconst getKeyWithValue = function(obj,value){\n  if(isArray(obj)){\n    for(var i=0,l=obj.length;i<l;i++) if(obj[i]===value) return i;\n  } \n  if(isObject(obj)){\n    for(var key in obj) if(obj[key]===value) return key;\n  }\n  return undefined;\n};\n\nexport const removeValue = function(obj,value){\n  var detect = true;\n  var array  = isArray(obj);\n\n  while(detect) {\n    var key = getKeyWithValue(obj,value);\n    if(typeof key === \"undefined\"){\n      detect = false;\n    } else {\n      if(array){\n        obj.splice(key,1);\n      } else {\n        delete obj[key];\n      }\n    }\n  }\n\n  return obj;\n};\n\nexport const instance = function(func,proto){\n  var ins,DummyInstance=function(param){ if(typeof param === \"object\") for(var k in param) this[k] = param[k]; };\n  if(typeof func == \"object\"){\n    if(typeof proto === \"object\") DummyInstance.prototype = proto;\n    ins = new DummyInstance(func);\n  }\n  if(typeof func == \"function\"){\n    if(typeof proto === \"object\") func.prototype = proto;\n    ins = (new func());\n  }\n  return ins;\n}\n\nexport const alloc = function(init) {\n  let fn = init();\n  const rn = function(...args) {\n    return fn.apply(this, args);\n  };\n  rn['reset'] = function() { fn = init(rn, rn); };\n  rn['$constructor'] = fn;\n  return rn;\n};\n\nconst syncData = (function(){\n  const ENTER_HOOK  = (newDatum)=>_.assign({}, newDatum);\n  const UPDATE_HOOK = (oldDatum, newDatum)=>_.assign({}, oldDatum, newDatum);\n  \n  return function(oldData, newData, getId, options) {\n    if(!/string|function/.test(typeof getId)) throw new Error(\"syncData need getId\");\n  \n    if(typeof getId === \"string\") {\n      const getIdString = getId;\n      getId = e=>_.get(e, getIdString);\n    }\n\n    oldData = asArray(oldData);\n    newData = asArray(newData);\n\n    const result = [];\n    const hooks  = asObject(options,\"afterEach\")\n    \n    if(typeof hooks[\"enter\"] !== \"function\"){\n      hooks[\"enter\"] = ENTER_HOOK;\n    }\n    \n    if(typeof hooks[\"update\"] !== \"function\"){\n      hooks[\"update\"] = UPDATE_HOOK;\n    }\n    \n    const oldDataMap = _.map(oldData, e=>{\n      return { id: getId(e), ref: e };\n    });\n    \n    \n    asArray(newData).forEach((newDatum, i)=>{\n      const newId = getId(newDatum);\n      let oldDatum = _.get(oldDataMap[_.findIndex(oldDataMap, e=>e.id === newId)], \"ref\");\n      let genDatum;\n      let dirty = false;\n\n      if(oldDatum) {\n        // change is not dirty, modify is dirty\n        if(typeof oldDatum !== typeof newDatum) {\n          dirty = false;\n        } else { // same type\n          const oldOwnKeys = Object.keys(oldDatum).filter(key=>!(key.indexOf(\"$\") === 0));\n          const newOwnKeys = Object.keys(newDatum).filter(key=>!(key.indexOf(\"$\") === 0));\n\n          // inspect key chnage\n          if(_.isEqual(oldOwnKeys, newOwnKeys)) {\n            dirty = !_.isEqual(_.pick(oldDatum, oldOwnKeys), _.pick(newDatum, newOwnKeys));\n          } else {\n            dirty = true;\n          }\n        }\n        \n        if(typeof hooks[\"beforeUpdate\"] === \"function\"){\n          if(hooks[\"beforeUpdate\"](oldDatum, newDatum) === false){\n            return;\n          }\n        }\n        \n        genDatum = hooks[\"update\"](oldDatum, newDatum);\n        \n        if(typeof hooks[\"afterUpdate\"] === \"function\"){\n          genDatum = hooks[\"afterUpdate\"](genDatum, oldDatum, newDatum);\n        }\n      } else {\n        if(typeof hooks[\"beforeEnter\"] === \"function\"){\n          if(hooks[\"beforeEnter\"](newDatum) === false){\n            return;\n          }\n        }\n        \n        genDatum = hooks[\"enter\"](newDatum);\n        \n        if(typeof hooks[\"afterEnter\"] === \"function\"){\n          genDatum = hooks[\"afterEnter\"](genDatum, newDatum);\n        }\n      }\n\n      if(typeof hooks[\"afterEach\"] === \"function\") {\n        hooks[\"afterEach\"](genDatum, i, dirty);\n      }\n\n      result.push(genDatum);\n    });\n\n    return result;\n  }\n}())"],"file":"cast.js"}