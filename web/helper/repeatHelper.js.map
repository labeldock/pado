{"version":3,"sources":["../../.src/web/helper/repeatHelper.js"],"names":["RepeatHelper","key","enterFn","enter","updateFn","update","exitFn","exit","oldBag","getKey","datum","repeater","data","newData","newBag","forEach","index","newDatumKey","newMeta","matchOldMeta","find","old","vm","$continue","push","oldMeta","prevMeta","result","Error","map","d"],"mappings":";;;;;;;;;;;;;;;;;;;;AAEe,WAASA,YAAT,OAA2E;AAAA,QAAnDC,GAAmD,QAAnDA,GAAmD;AAAA,QAAxCC,OAAwC,QAA9CC,KAA8C;AAAA,QAAxBC,QAAwB,QAA/BC,MAA+B;AAAA,QAATC,MAAS,QAAdC,IAAc;AACxF;AACA,QAAIC,SAAS,EAAb,CAFwF,CAIxF;;AACA,QAAMC,SAAS,OAAOR,GAAP,KAAe,UAAf,GAA4BA,GAA5B,GAAkC,UAASS,KAAT,EAAe;AAC9D,aAAOA,MAAMT,GAAN,CAAP;AACD,KAFD,CALwF,CASxF;;AACA,QAAMU,WAAW,SAAXA,QAAW,CAASC,IAAT,EAAc;AAC7B,UAAIC,UAAU,wBAAQD,IAAR,CAAd;AACA,UAAIE,SAAU,EAAd,CAF6B,CAI7B;;AACAD,cAAQE,OAAR,CAAgB,UAACL,KAAD,EAAQM,KAAR,EAAgB;AAC9B;AACA,YAAMC,cAAcR,OAAOC,KAAP,KAAiBM,KAArC,CAF8B,CAI9B;;AACA,YAAME,UAAU;AACdjB,eAAIgB,WADU;AAEdP,iBAAMA;AAFQ,SAAhB,CAL8B,CAU9B;;AACA,YAAMS,eAAeX,OAAOY,IAAP,CAAY;AAAA,iBAAKC,IAAIpB,GAAJ,KAAYgB,WAAjB;AAAA,SAAZ,CAArB,CAX8B,CAa9B;;AACA,YAAGE,YAAH,EAAgB;AACd;AACAD,kBAAQI,EAAR,GAAaH,aAAaG,EAA1B;AACAH,uBAAaI,SAAb,GAAyB,IAAzB;AACD;;AAEDT,eAAOU,IAAP,CAAYN,OAAZ;AACD,OArBD,EAL6B,CA4B7B;;AACAV,aAAOO,OAAP,CAAe,mBAAS;AACtB,YAAG,CAACU,QAAQF,SAAZ,EAAsB;AACpBjB,iBAAOmB,OAAP;AACD;AACF,OAJD,EA7B6B,CAmC7B;;AACAX,aAAOC,OAAP,CAAe,UAACG,OAAD,EAAUF,KAAV,EAAkB;AAC/B,YAAMU,WAAWZ,OAAOE,QAAQ,CAAf,CAAjB;;AACA,YAAGU,YAAYA,SAAS,IAAT,CAAf,EAA8B;AAC5BR,kBAAQ,QAAR,IAAoBQ,SAAS,IAAT,CAApB;AACD;AACF,OALD,EApC6B,CA2C7B;;AACAZ,aAAOC,OAAP,CAAe,UAACG,OAAD,EAAUF,KAAV,EAAkB;AAC/B,YAAG,CAACE,QAAQI,EAAZ,EAAe;AACb,cAAIK,SAASzB,QAAQgB,OAAR,EAAiBF,KAAjB,CAAb;;AACA,cAAG,CAACW,MAAJ,EAAW;AACT,kBAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN;AACD,WAFD,MAEO;AACLV,oBAAQ,IAAR,IAAgBS,MAAhB;AACD;AACF;AACF,OATD,EA5C6B,CAuD7B;;AACAvB,kBAAYU,OAAOC,OAAP,CAAe,UAACG,OAAD,EAAUF,KAAV,EAAkB;AAC3CZ,iBAASc,OAAT,EAAkBF,KAAlB;AACD,OAFW,CAAZ,CAxD6B,CA4D7B;;AACAR,eAASM,MAAT;AACD,KA9DD,CAVwF,CA0ExF;;;AACAH,aAAS,IAAT,IAAiB,YAAU;AACzB,aAAOH,OAAOqB,GAAP,CAAW;AAAA,eAAGC,EAAER,EAAL;AAAA,OAAX,CAAP;AACD,KAFD;;AAIA,WAAOX,QAAP;AACD;;AAAA","sourcesContent":["import { asArray } from '../../functions';\n\nexport default function RepeatHelper({ key, enter:enterFn, update:updateFn, exit:exitFn }){\n  // {key:string, vm:Component}\n  let oldBag = [];\n  \n  // 모델의 키를 얻는 함수\n  const getKey = typeof key === \"function\" ? key : function(datum){\n    return datum[key];\n  }\n  \n  // ng-repeat, v-for와 같은 리피터 구현체 (d3의 data().enter().exit() 컨샙이 비슷함)\n  const repeater = function(data){\n    let newData = asArray(data);\n    let newBag  = [];\n    \n    //새 데이터를 검사합니다.\n    newData.forEach((datum, index)=>{\n      //키를 추출합니다.\n      const newDatumKey = getKey(datum) || index;\n      \n      //키 샘플입니다.\n      const newMeta = {\n        key:newDatumKey,\n        datum:datum,\n      };\n      \n      //매치되는 오래된 메타를 확인합니다.\n      const matchOldMeta = oldBag.find(old=>old.key === newDatumKey);\n      \n      //오래된 메타가 확인될 시\n      if(matchOldMeta){\n        //exit를 하지 않고 살립니다.\n        newMeta.vm = matchOldMeta.vm;\n        matchOldMeta.$continue = true;\n      }\n      \n      newBag.push(newMeta);\n    });\n    \n    //exit (require)\n    oldBag.forEach(oldMeta=>{\n      if(!oldMeta.$continue){\n        exitFn(oldMeta);\n      }\n    });\n    \n    //메타에 추가 정보 입력 (prevVm)\n    newBag.forEach((newMeta, index)=>{\n      const prevMeta = newBag[index - 1];\n      if(prevMeta && prevMeta[\"vm\"]){\n        newMeta[\"prevVm\"] = prevMeta[\"vm\"];\n      }\n    });\n    \n    //enter (require)\n    newBag.forEach((newMeta, index)=>{\n      if(!newMeta.vm){\n        let result = enterFn(newMeta, index);\n        if(!result){\n          throw new Error(\"enter는 반드시 vm을 리턴해야합니다.\");\n        } else {\n          newMeta[\"vm\"] = result;\n        }\n      }\n    });\n    \n    //update (option)\n    updateFn && newBag.forEach((newMeta, index)=>{\n      updateFn(newMeta, index);\n    });\n    \n    //history change\n    oldBag = newBag;\n  }\n  \n  //컴포넌트에서 정렬된 데이터를 얻기위한 용도로 제작. Component에서 (개발 시간상) 한계로 이곳에서 수행\n  repeater[\"vm\"] = function(){\n    return oldBag.map(d=>d.vm);\n  }\n  \n  return repeater;\n};"],"file":"repeatHelper.js"}