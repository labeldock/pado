{"version":3,"sources":["../../.src/web/helper/dragHelper.js"],"names":["DEVICE_EVENT","window","DocumentTouch","document","START","MOVE","END","touchFixX","touchFixY","pointerParse","clientX","clientY","touches","x","y","touchClientX","touchClientY","preventDefaultFn","e","preventDefault","DragHelper","element","option","$element","eq","startFn","moveFn","endFn","dragParams","firstDrag","lastDrag","resetOptions","getOptions","getCurrentPointerDrag","originalEvent","pointerDrag","moveX","moveY","offsetX","offsetY","leftValue","offset","left","topValue","top","dragEnter","elementOffset","predict","pointer","undefined","event","on","dragMove","dragExit","body","attr","off","removeAttr"],"mappings":"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","sourcesContent":["import $ from '../plugins/jquery';\nimport { rebase } from '../../functions';\n\n//\nconst DEVICE_EVENT = (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ?\n{\n  START:'touchstart',\n  MOVE:'touchmove',\n  END:'touchend'\n}:\n{\n  START:'mousedown',\n  MOVE:'mousemove',\n  END:'mouseup'\n};\n\n//드래그\nlet touchFixX;\nlet touchFixY;\nconst pointerParse = ({ clientX, clientY, touches })=>{\n  if(touches){\n    if(!touches[0]){\n      return {\n        x:touchFixX,\n        y:touchFixY\n      }\n    };\n    \n    const { clientX:touchClientX, clientY:touchClientY } = touches[0];\n    touchFixX = touchClientX;\n    touchFixY = touchClientY;\n    \n    return {\n      x:touchClientX,\n      y:touchClientY\n    };\n  }\n  return {\n    x:clientX,\n    y:clientY\n  };\n};\n\nconst preventDefaultFn = (e)=>e.preventDefault();\n\nexport default function DragHelper(element,option){\n  const $element = $(element).eq(0);\n  let startFn;\n  let moveFn;\n  let endFn;\n  \n  let dragParams = null;\n  let firstDrag  = null;\n  let lastDrag   = null;\n  \n  const resetOptions = function(){\n    const getOptions = rebase(typeof option === \"function\" ? option({ element:$element }) : option);\n    startFn = getOptions[\"start\"];\n    moveFn = getOptions[\"move\"];\n    endFn = getOptions[\"end\"];\n  };\n  \n  const getCurrentPointerDrag = function(originalEvent){\n    const pointerDrag = pointerParse(originalEvent);\n  \n    //현재 이동한 거리\n    pointerDrag.moveX = pointerDrag.x - lastDrag.x;\n    pointerDrag.moveY = pointerDrag.y - lastDrag.y;\n    \n    //처음으로부터 변경된 거리\n    pointerDrag.offsetX = pointerDrag.x - firstDrag.x;\n    pointerDrag.offsetY = pointerDrag.y - firstDrag.y;\n    \n    //처음으로 부터 변경되어 엘리먼트 오프셋 크기\n    pointerDrag.leftValue = dragParams.offset.left + pointerDrag.offsetX;\n    pointerDrag.topValue  = dragParams.offset.top + pointerDrag.offsetY;\n    \n    pointerDrag.left = pointerDrag.leftValue + \"px\";\n    pointerDrag.top  = pointerDrag.topValue + pointerDrag.offsetY + \"px\";\n    \n    return pointerDrag;\n  }\n  \n  const dragEnter = function({ originalEvent }){\n    //init\n    resetOptions();\n    \n    //\n    const elementOffset = $element.predict();\n    const pointerDrag   = pointerParse(originalEvent);\n    \n    firstDrag = pointerDrag;\n    lastDrag  = pointerDrag;\n    \n    dragParams = { offset:elementOffset, pointer:undefined, event:originalEvent };\n    dragParams.pointer = getCurrentPointerDrag(originalEvent);\n    \n    startFn && startFn(dragParams);\n    \n    $(document)\n    .on(DEVICE_EVENT.MOVE,dragMove)\n    .on(DEVICE_EVENT.END,dragExit);\n    \n    $(document.body)\n    .on(DEVICE_EVENT.MOVE,preventDefaultFn)\n    .attr(\"dragging\", \"\");\n  };\n  \n  const dragMove = function({ originalEvent, preventDefault }){\n    const pointerDrag = pointerParse(originalEvent);\n    \n    if(!moveFn){\n      lastDrag = pointerDrag;\n      return;\n    } else {\n      dragParams.pointer = getCurrentPointerDrag(originalEvent);\n      dragParams.event   = originalEvent;\n      moveFn(dragParams);\n      lastDrag = pointerDrag;\n    }\n  };\n  \n  const dragExit = function({ originalEvent }){\n    dragParams.pointer = getCurrentPointerDrag(originalEvent);\n    dragParams.event   = originalEvent;\n    endFn && endFn(dragParams);\n    dragParams = undefined;\n    \n    $(document)\n    .off(DEVICE_EVENT.MOVE,dragMove)\n    .off(DEVICE_EVENT.END,dragExit);\n    \n    $(document.body)\n    .off(DEVICE_EVENT.MOVE,preventDefaultFn)\n    .removeAttr(\"dragging\");\n  };\n  \n  $element.on(DEVICE_EVENT.START,dragEnter);\n  \n  return $element;\n}"],"file":"dragHelper.js"}