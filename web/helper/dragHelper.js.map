{"version":3,"sources":["../../packages/pado/web/helper/dragHelper.js"],"names":["DEVICE_EVENT","window","DocumentTouch","document","TOUCH_DEVICE","START","MOVE","END","dragRetainCount","bindDraggingAttribute","body","setAttribute","removeAttribute","addEventListener","e","preventDefault","passive","touchFixX","touchFixY","pointerParse","clientX","clientY","touches","x","y","touchClientX","touchClientY","DragHelper","element","option","startFn","moveFn","endFn","dragParams","firstDrag","lastDrag","resetOptions","getOptions","getCurrentPointerDrag","originalEvent","pointerDrag","moveX","moveY","offsetX","offsetY","leftValue","offset","left","topValue","top","dragEnter","elementOffset","pointer","undefined","event","dragMove","dragExit","removeEventListener"],"mappings":"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","sourcesContent":["import { queryFind, predict } from \"../finder\";\nimport { rebase } from '../../functions';\n\n// eslint-disable-next-line no-undef\nconst DEVICE_EVENT = (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch)\n  ? {\n    TOUCH_DEVICE: true,\n    START       : 'touchstart',\n    MOVE        : 'touchmove',\n    END         : 'touchend'\n  }\n  : {\n    TOUCH_DEVICE: false,\n    START       : 'mousedown',\n    MOVE        : 'mousemove',\n    END         : 'mouseup'\n  }\n\n//\nlet dragRetainCount = 0\n\n//\nconst bindDraggingAttribute = function (){\n  if(dragRetainCount > 0){\n    document.body.setAttribute(\"dragging\", \"\")\n  } else {\n    document.body.removeAttribute(\"dragging\")\n  }\n}\n\n//\nDEVICE_EVENT.TOUCH_DEVICE && window.addEventListener(\"touchmove\", (e)=>{\n  dragRetainCount > 0 && e.preventDefault()\n}, {passive: false})\n\n\n//드래그\nlet touchFixX\nlet touchFixY\nconst pointerParse = ({ clientX, clientY, touches })=>{\n  if(touches){\n    if(!touches[0]){\n      return {\n        x: touchFixX,\n        y: touchFixY\n      }\n    };\n    \n    const { clientX:touchClientX, clientY:touchClientY } = touches[0]\n    touchFixX = touchClientX\n    touchFixY = touchClientY\n    \n    return {\n      x: touchClientX,\n      y: touchClientY\n    }\n  }\n  return {\n    x: clientX,\n    y: clientY\n  }\n}\n\nexport default function DragHelper (element, option){\n  element = queryFind(element, 0);\n  \n  let startFn\n  let moveFn\n  let endFn\n  \n  let dragParams = null\n  let firstDrag  = null\n  let lastDrag   = null\n  \n  const resetOptions = function (){\n    const getOptions = rebase(typeof option === \"function\" ? option({ element }) : option)\n    startFn = getOptions[\"start\"]\n    moveFn = getOptions[\"move\"]\n    endFn = getOptions[\"end\"]\n  }\n  \n  const getCurrentPointerDrag = function (originalEvent){\n    const pointerDrag = pointerParse(originalEvent)\n  \n    //현재 이동한 거리\n    pointerDrag.moveX = pointerDrag.x - lastDrag.x\n    pointerDrag.moveY = pointerDrag.y - lastDrag.y\n    \n    //처음으로부터 변경된 거리\n    pointerDrag.offsetX = pointerDrag.x - firstDrag.x\n    pointerDrag.offsetY = pointerDrag.y - firstDrag.y\n    \n    //처음으로 부터 변경되어 엘리먼트 오프셋 크기\n    pointerDrag.leftValue = dragParams.offset.left + pointerDrag.offsetX\n    pointerDrag.topValue = dragParams.offset.top + pointerDrag.offsetY\n    \n    pointerDrag.left = pointerDrag.leftValue + \"px\"\n    pointerDrag.top = pointerDrag.topValue + pointerDrag.offsetY + \"px\"\n    \n    return pointerDrag\n  }\n  \n  const dragEnter = function (originalEvent){\n    //init\n    resetOptions()\n    \n    //\n    const elementOffset = predict(element);\n    const pointerDrag   = pointerParse(originalEvent)\n    \n    firstDrag = pointerDrag\n    lastDrag = pointerDrag\n    \n    dragParams = { offset: elementOffset, pointer: undefined, event: originalEvent }\n    dragParams.pointer = getCurrentPointerDrag(originalEvent)\n    \n    startFn && startFn(dragParams)\n    \n    document.addEventListener(DEVICE_EVENT.MOVE, dragMove)\n    document.addEventListener(DEVICE_EVENT.END, dragExit)\n    \n    dragRetainCount += 1\n    bindDraggingAttribute()\n  }\n  \n  const dragMove = function (originalEvent){\n    const pointerDrag = pointerParse(originalEvent)\n    \n    if(!moveFn){\n      lastDrag = pointerDrag\n      return\n    } else {\n      dragParams.pointer = getCurrentPointerDrag(originalEvent)\n      dragParams.event = originalEvent\n      moveFn(dragParams)\n      lastDrag = pointerDrag\n    }\n  }\n  \n  const dragExit = function (originalEvent){\n    dragParams.pointer = getCurrentPointerDrag(originalEvent)\n    dragParams.event = originalEvent\n    endFn && endFn(dragParams)\n    dragParams = undefined\n    \n    document.removeEventListener(DEVICE_EVENT.MOVE, dragMove)\n    document.removeEventListener(DEVICE_EVENT.END, dragExit)\n    \n    dragRetainCount -= 1\n    bindDraggingAttribute()\n  }\n  \n  element.addEventListener(\"dragstart\", function (e){\n    e.preventDefault()\n  })\n  \n  element.addEventListener(DEVICE_EVENT.START, dragEnter)\n  \n  return element\n}\n"],"file":"dragHelper.js"}