{"version":3,"sources":["../../packages/pado/web/finder/query-selector.js"],"names":["QUERY_SELECTOR_ENGINE","node","selector","Array","from","document","QUERY_SELECTOR_NAME","replace","s","substr","length","e","console","error","MATCHES_SELECTOR_ENGINE","MATCHES_SELECTOR_NAME","nodeList","eq","map","item","undefined","is","selectText","query","root","trim","concat","prototype","slice","call","toCSSQueryString","detail","t","tag","tagName","toLowerCase","tid","tclass","tname","tattr","tvalue","N","propEach","NODEKIT","attr","value","sign","id","getAttribute","split","join","attrValue","test","tv"],"mappings":"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","sourcesContent":["import { asArray } from '../../functions/cast'\nimport { isNode } from '../../functions/isLike';\n\nconst QUERY_SELECTOR_ENGINE = function(node,selector){\n  try {\n    return Array.from(\n      (node||document)[QUERY_SELECTOR_NAME](\n        selector.replace(/\\[[\\w\\-\\_]+\\=[^\\'\\\"][^\\]]+\\]/g, function(s){\n          return s.replace(/\\=.+\\]$/,function(s){\n            return '=\\\"' + s.substr(1,s.length-2) + '\\\"]';\n          })\n        })\n      )\n    );\n  } catch(e) {\n    console.error(\"QUERY_SELECTOR_ENGINE error\",node,selector);\n  }\n};\n\nconst MATCHES_SELECTOR_ENGINE = function(node,selector){\n  return node[MATCHES_SELECTOR_NAME](\n    selector.replace(/\\[[\\w\\-\\_]+\\=[^\\'\\\"][^\\]]+\\]/g, function(s){\n      return s.replace(/\\=.+\\]$/,function(s){\n        return '=\\\"' + s.substr(1,s.length-2) + '\\\"]';\n      })\n    })\n  );\n}\n\nexport const nodeList = function(node, eq){\n  node = asArray(node).map(item=>isNode(item)?item:undefined);\n  return typeof eq === \"number\" ? node[eq] : node;\n};\n\nexport const is = function(node,selectText){\n  return !isNode(node) ? false : ((typeof selectText === \"undefined\") || selectText == \"*\" || selectText == \"\") ? true : MATCHES_SELECTOR_ENGINE(node,selectText);\n};\n\nexport const query = function(query,root){\n  //querySelectorSupport\n  if(typeof query !== \"string\" || (query.trim().length == 0)) return [];\n  root = ((typeof root === \"undefined\") ? document : isNode(root) ? root : document);\n  return root == document ?\n    QUERY_SELECTOR_ENGINE(root,query) :\n    MATCHES_SELECTOR_ENGINE(root,query) ?\n    [root].concat(Array.prototype.slice.call(QUERY_SELECTOR_ENGINE(root,query))) :\n    QUERY_SELECTOR_ENGINE(root,query);\n};\n\nexport const toCSSQueryString = function(node, detail){\n  var t = nodeList(node, 0)[0];\n  if(!t) return undefined;\n  var tag = t.tagName.toLowerCase();\n  var tid = tclass = tname = tattr = tvalue = '';\n  N.propEach(N.NODEKIT.attr(t),function(value,sign){\n    switch(sign){\n    case \"id\"   :\n      var id = t.getAttribute(sign);\n      id.length && (tid='#'+id) ;\n      break;\n    case \"class\":\n      tclass = t.getAttribute(sign).trim().replace(/\\s\\s/g,' ').split(' ').join('.');\n      if(tclass) tclass = \".\" + tclass;\n      break;\n      case \"name\" : tname  = \"[name=\"+t.getAttribute(sign)+\"]\"; break;\n      case \"value\": break;\n      default     :\n      if(detail == true) {\n        attrValue = t.getAttribute(sign);\n        tattr += ( (attrValue == '' || attrValue == null) ? (\"[\"+sign+\"]\") : (\"[\"+sign+\"=\"+attrValue+\"]\") );\n      }\n      break;\n    }\n  });\n\n  if(detail == true) {\n    if(!/table|tbody|thead|tfoot|ul|ol/.test(tag)) {\n      var tv = N.node.value(t);\n      if(typeof tv !== undefined || tv !== null ) if(typeof tv === 'string' && tv.length !== 0) tvalue = '::'+tv;\n      if(typeof tvalue === 'string') tvalue = tvalue.trim();\n    }\n  }\n\n  return tag+tid+tclass+tname+tattr+tvalue;\n}\n"],"file":"query-selector.js"}