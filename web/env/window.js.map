{"version":3,"sources":["../../.src/web/env/window.js"],"names":["reservedSessionStorage","pulledWindowToken","pulledWindowSession","openerPresenceProps","windowServiceReserveSession","name","data","listenHandshake","window","windowServiceHandshake","console","log","windowServicePullSession","getOpenerPresenceProperties","opener","e","warn","saveSessionFn","token","addEventListener","windowProps","WINDOW_POPUP_DEFAULT_WIDTH","WINDOW_POPUP_DEFAULT_HEIGHT","openWindow","href","windowParam","hasParam","windowName","useResize","undefined","destWindowWidth","destWindowHeight","destWindowTop","destWindowLeft","availMaxWidth","screen","availWidth","availMaxHeight","availHeight","navigator","platform","indexOf","newWindow","open","closeWindow","close","openTab","focus","historyBack","catchFallback","history","initialPage","length","location","back"],"mappings":"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","sourcesContent":["const { windowServiceReserveSession, getOpenerPresenceProperties } = (function(){\n  //to children\n  const reservedSessionStorage = {};\n  \n  //my window\n  let pulledWindowToken;\n  let pulledWindowSession;\n  let openerPresenceProps;\n  \n  //(부모) 윈도우의 정보를 저장\n  const windowServiceReserveSession = function(name,data,listenHandshake){\n    if(listenHandshake === true){\n      window.windowServiceHandshake = function(){\n        delete window.windowServiceHandshake;\n        return name;\n      };\n    }\n    reservedSessionStorage[name] = data;\n    console.log('reservedSessionStorage',reservedSessionStorage);\n    return reservedSessionStorage[name];\n  };\n\n  //자식에게 세션을 당겨올수 있도록 지원\n  const windowServicePullSession = function(name){\n    //console.log(\"windowServicePullSession\",name);\n    var data = reservedSessionStorage[name];\n    delete reservedSessionStorage[name];\n    return data;\n  };\n  \n  //\n  const getOpenerPresenceProperties = function(){\n    if(typeof openerPresenceProps === \"function\"){\n      return openerPresenceProps()\n    }\n    return openerPresenceProps;\n  };\n  \n  window.windowServiceReserveSession = windowServiceReserveSession;\n  window.windowServicePullSession    = windowServicePullSession;\n\n  try {\n    if(window.opener && window.opener.windowServiceHandshake){\n      pulledWindowToken = window.opener.windowServiceHandshake();\n    }\n  } catch(e){\n    console.warn(\"window.opener.windowServiceHandshake error\");\n  }\n    \n  if(pulledWindowToken && window.opener && window.opener.windowServicePullSession){\n    pulledWindowSession  = window.opener.windowServicePullSession(pulledWindowToken);\n    openerPresenceProps = pulledWindowSession;\n    \n    //임의로 언로드 됐을때 세션을 임시 저장\n    var saveSessionFn = function(){\n      try {\n        window.opener &&\n        window.opener.windowServiceReserveSession &&\n        window.opener.windowServiceReserveSession(pulledWindowSession.token,pulledWindowSession,true);\n      } catch(e) {\n        console.warn(\"Parent window not found.\",e);\n      }\n    };\n    \n    window.addEventListener(\"beforeunload\",saveSessionFn);\n  }\n  \n  return { windowServiceReserveSession, getOpenerPresenceProperties };\n}());\n\nexport const windowProps = getOpenerPresenceProperties;\n\nconst WINDOW_POPUP_DEFAULT_WIDTH = 1100;\nconst WINDOW_POPUP_DEFAULT_HEIGHT = 900;\n\nexport const openWindow = function(href, windowParam) {\n  const hasParam    = typeof windowParam === \"object\";\n  const windowName  = hasParam && windowParam[\"name\"] || \"_blank\";\n  const useResize   = (hasParam && windowParam[\"resize\"]+\"\") !== \"false\";\n  const windowProps = hasParam ? windowParam[\"props\"] : undefined;\n  \n  let destWindowWidth  = (hasParam && windowParam[\"width\"] || WINDOW_POPUP_DEFAULT_WIDTH);\n  let destWindowHeight = (hasParam && windowParam[\"height\"] || WINDOW_POPUP_DEFAULT_HEIGHT);\n  let destWindowTop    = (hasParam && windowParam[\"top\"] || windowParam[\"y\"] || 0);\n  let destWindowLeft   = (hasParam && windowParam[\"left\"] || windowParam[\"x\"] || 0);\n\n  const availMaxWidth = screen.availWidth;\n  let availMaxHeight = screen.availHeight;\n\n  // IE bottom bar\n  if(navigator.platform.indexOf(\"Win\") === 0) {\n    availMaxHeight -= 65;\n  }\n\n  if(destWindowWidth > availMaxWidth) destWindowWidth = availMaxWidth;\n  if(destWindowHeight > availMaxHeight) destWindowHeight = availMaxHeight;\n  \n  windowServiceReserveSession(windowName,windowProps,true);\n  \n  const newWindow = window.open(\n    href,\n    windowName,\n    `top=${destWindowTop},left=${destWindowLeft},width=${destWindowWidth},height=${destWindowHeight}${useResize ? \",resizable=1\" : \",resizable=0\"},scrollbars=yes,status=1`\n  );\n\n  return newWindow;\n};\n\nexport const closeWindow = function(){\n  window.close();\n};\n\nexport const openTab = function(href) {\n  const newWindow = window.open(href, '_blank');\n  newWindow.focus();\n  return newWindow;\n};\n\nexport const historyBack = function({ catchFallback }) {\n  try {\n    const history = window.history;\n    const initialPage = history.length < 2;\n\n    if(initialPage && catchFallback) {\n      if(typeof catchFallback === \"string\") {\n        location.href = catchFallback;\n      }\n      if(typeof catchFallback === \"function\") {\n        return catchFallback();\n      }\n    } else {\n      history.back();\n    }\n  } catch (e) {\n    return null;\n  }\n};"],"file":"window.js"}