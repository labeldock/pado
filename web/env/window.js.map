{"version":3,"sources":["../../packages/pado/web/env/window.js"],"names":["reservedSessionStorage","pulledWindowToken","pulledWindowSession","openerPresenceProps","windowServiceReserveSession","name","data","listenHandshake","window","windowServiceHandshake","windowServicePullSession","getOpenerPresenceProperties","opener","e","console","warn","saveSessionFn","token","addEventListener","windowProps","WINDOW_POPUP_DEFAULT_WIDTH","WINDOW_POPUP_DEFAULT_HEIGHT","openWindow","href","windowParam","hasParam","windowName","useResize","undefined","destWindowWidth","destWindowHeight","destWindowTop","destWindowLeft","availMaxWidth","screen","availWidth","availMaxHeight","availHeight","navigator","platform","indexOf","newWindow","open","closeWindow","close","openTab","focus","historyBack","catchFallback","history","initialPage","length","location","back"],"mappings":"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","sourcesContent":["const { windowServiceReserveSession, getOpenerPresenceProperties } = (function (){\n  //to children\n  const reservedSessionStorage = {}\n  \n  //my window\n  let pulledWindowToken\n  let pulledWindowSession\n  let openerPresenceProps\n  \n  //(부모) 윈도우의 정보를 저장\n  const windowServiceReserveSession = function (name, data, listenHandshake){\n    if(listenHandshake === true){\n      window.windowServiceHandshake = function (){\n        delete window.windowServiceHandshake\n        return name\n      }\n    }\n    reservedSessionStorage[name] = data\n    return reservedSessionStorage[name]\n  }\n\n  //자식에게 세션을 당겨올수 있도록 지원\n  const windowServicePullSession = function (name){\n    //console.log(\"windowServicePullSession\",name);\n    var data = reservedSessionStorage[name]\n    delete reservedSessionStorage[name]\n    return data\n  }\n  \n  //\n  const getOpenerPresenceProperties = function (){\n    if(typeof openerPresenceProps === \"function\"){\n      return openerPresenceProps()\n    }\n    return openerPresenceProps\n  }\n  \n  window.windowServiceReserveSession = windowServiceReserveSession\n  window.windowServicePullSession = windowServicePullSession\n\n  try {\n    if(window.opener && window.opener.windowServiceHandshake){\n      pulledWindowToken = window.opener.windowServiceHandshake()\n    }\n  } catch (e){\n    console.warn(\"window.opener.windowServiceHandshake error\")\n  }\n    \n  if(pulledWindowToken && window.opener && window.opener.windowServicePullSession){\n    pulledWindowSession = window.opener.windowServicePullSession(pulledWindowToken)\n    openerPresenceProps = pulledWindowSession\n    \n    //임의로 언로드 됐을때 세션을 임시 저장\n    var saveSessionFn = function (){\n      try {\n        window.opener &&\n        window.opener.windowServiceReserveSession &&\n        window.opener.windowServiceReserveSession(pulledWindowSession.token, pulledWindowSession, true)\n      } catch (e){\n        console.warn(\"Parent window not found.\", e)\n      }\n    }\n    \n    window.addEventListener(\"beforeunload\", saveSessionFn)\n  }\n  \n  return { windowServiceReserveSession, getOpenerPresenceProperties }\n}())\n\nexport const windowProps = getOpenerPresenceProperties\n\nconst WINDOW_POPUP_DEFAULT_WIDTH = 1100\nconst WINDOW_POPUP_DEFAULT_HEIGHT = 900\n\nexport const openWindow = function (href, windowParam){\n  const hasParam    = typeof windowParam === \"object\"\n  const windowName  = hasParam && windowParam[\"name\"] || \"_blank\"\n  const useResize   = (hasParam && windowParam[\"resize\"] + \"\") !== \"false\"\n  const windowProps = hasParam ? windowParam[\"props\"] : undefined\n  \n  let destWindowWidth  = (hasParam && windowParam[\"width\"] || WINDOW_POPUP_DEFAULT_WIDTH)\n  let destWindowHeight = (hasParam && windowParam[\"height\"] || WINDOW_POPUP_DEFAULT_HEIGHT)\n  let destWindowTop    = (hasParam && windowParam[\"top\"] || windowParam[\"y\"] || 0)\n  let destWindowLeft   = (hasParam && windowParam[\"left\"] || windowParam[\"x\"] || 0)\n\n  const availMaxWidth = screen.availWidth\n  let availMaxHeight = screen.availHeight\n\n  // IE bottom bar\n  if(navigator.platform.indexOf(\"Win\") === 0){\n    availMaxHeight -= 65\n  }\n\n  if(destWindowWidth > availMaxWidth) destWindowWidth = availMaxWidth\n  if(destWindowHeight > availMaxHeight) destWindowHeight = availMaxHeight\n  \n  windowServiceReserveSession(windowName, windowProps, true)\n  \n  const newWindow = window.open(\n    href,\n    windowName,\n    `top=${destWindowTop},left=${destWindowLeft},width=${destWindowWidth},height=${destWindowHeight}${useResize ? \",resizable=1\" : \",resizable=0\"},scrollbars=yes,status=1`\n  )\n\n  return newWindow\n}\n\nexport const closeWindow = function (){\n  window.close()\n}\n\nexport const openTab = function (href){\n  const newWindow = window.open(href, '_blank')\n  newWindow.focus()\n  return newWindow\n}\n\nexport const historyBack = function ({ catchFallback }){\n  try {\n    const history = window.history\n    const initialPage = history.length < 2\n\n    if(initialPage && catchFallback){\n      if(typeof catchFallback === \"string\"){\n        location.href = catchFallback\n      }\n      if(typeof catchFallback === \"function\"){\n        return catchFallback()\n      }\n    } else {\n      history.back()\n    }\n  } catch (e){\n    return null\n  }\n}\n"],"file":"window.js"}