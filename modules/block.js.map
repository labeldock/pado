{"version":3,"sources":["../packages/pado/modules/block.js"],"names":["hasValueProperty","obj","value","key","arguments","length","i","l","Block","posSize","syncOpt","Object","defineProperties","$space","enumerable","writable","undefined","$posSize","$mask","$compute","$sync","domainValue","get","domainSize","rangeStart","domainRange","rangeSize","domainRangeSize","sync","BlockPrototype","domainMap","start","size","end","rangeMap","$start","sel","$size","rangeEnd","map","assign","block","clone","setPosition","Array","setSize","conflicts","otherBlocks","selector","reduce","red","selectOtherBlock","inspectResult","thisPos","otherPos","push","bind","hasConflicts","overflow","mask","blockPosSize","spaceDomain","domain","overflowDomain","$overflowSelected","$domain","isOverflow","f","maskOverflow","isMaskOverflow","compute","func","call","prototype","Tracker","space","domainMask","$domainMask","v","domainBlock","cursor","callback","domainGrid","range","rangeDomain","cursorPoint","blockMap","Space","$niceDomain","$niceRange","$range","set","vs","tracker"],"mappings":"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","sourcesContent":["import {\n  get,\n  hashMap,\n  domainRangeValue\n} from '../functions'\n\nimport {\n  isArray,\n  likeObject,\n  isEmpty\n} from '../functions/isLike'\n\nimport {\n  asArray,\n  cloneDeep\n} from '../functions/cast'\n\n// ?\nconst hasValueProperty = function (obj, value, key){\n  if(arguments.length == 1 && likeObject(obj)) return isEmpty(obj)\n  if(isArray(obj)) for(var i = 0, l = obj.length; i < l; i++) if(obj[i] === value) return true\n  if(likeObject(obj)){\n    if(key){\n      return get(obj, key) === value\n    } else {\n      for(var key in obj) if(get(obj, key) === value) return true\n    }\n  }\n  return false\n}\n\n\n//Scale foundation\n//정의역과 치역을 계산하여 결과값을 리턴함, 속성별로 정의하여 다중 차원 지원\n\nconst Block = function (posSize, syncOpt){\n  Object.defineProperties(this, {\n    $space     : { enumerable: false, writable: true, value: undefined },\n    $posSize   : { enumerable: false, writable: true, value: undefined },\n    $mask      : { enumerable: false, writable: true, value: undefined },\n    $compute   : { enumerable: false, writable: true, value: undefined },\n    $sync      : { enumerable: false, writable: true, value: undefined },\n    domainValue: { \n      enumerable: true,\n      get:()=>{\n        return hashMap(cloneDeep(this.get()), function (posSize){ return posSize[0]; });\n      }\n    },\n    domainSize: { \n      enumerable: true,\n      get:()=>{\n        return hashMap(cloneDeep(this.get()), function (posSize){ return posSize[1]; });\n      }\n    },\n    rangeStart: { \n      enumerable: true,\n      get:()=>{\n        return this.$space.domainRange(hashMap(this.get(), function (posSize){ return posSize[0]; }));\n      }\n    },\n    rangeSize: { \n      enumerable: true,\n      get:()=>{\n        return this.$space.domainRangeSize(hashMap(this.get(), function (posSize){ return posSize[1]; }));\n      }\n    }\n  })\n  \n  this.sync(posSize, syncOpt)\n}\n  \nconst BlockPrototype = {}\n\nObject.defineProperties(BlockPrototype, {\n  domainMap: { \n    enumerable: false,\n    get (){\n      return hashMap(cloneDeep(this.get()), function (posSize){\n        return {\n          start: posSize[0],\n          size : posSize[1],\n          end  : posSize[0] + posSize[1]\n        }\n      })\n    }\n  },\n  rangeMap: { \n    enumerable: false,\n    get (){\n      const rangeSize = this.rangeSize\n              \n      return hashMap(this.rangeStart, function ($start, sel){ \n        var $size = sel ? rangeSize[sel] : rangeSize\n        return {\n          start: $start,\n          size : $size,\n          end  : $start + $size\n        }\n      })\n    }\n  },\n  rangeEnd: { \n    enumerable: false,\n    get (){\n      return this.rangeMap(this.rangeMap, function (map){ return map.end })\n    }\n  }\n})\n\nObject.assign(BlockPrototype, {\n  sync: function (block, syncOpt){ \n    if(!arguments.length && this.$sync){\n      block = this.$sync()\n    } else if(typeof block === \"function\"){\n      this.$sync = block\n      if(syncOpt == true){\n        block = this.$sync()\n      } else {\n        return this\n      }\n    }\n    if(block instanceof Block){ \n      this.$posSize = cloneDeep(block.$posSize)\n      //.. this.$sync    = this.$sync || block.$sync\n      this.$space = this.$space || block.$space \n      this.$mask = this.$mask || block.$mask \n    } else {\n      this.$posSize = hashMap(cloneDeep(block), function (posSize){ return !isArray(posSize) ? [posSize, 0] : posSize })\n    }\n    return this \n  },\n  clone      : function (){ return new Block(this) },\n  setPosition: function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[0] = value; return this },\n  setSize    : function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[1] = value; return this },\n  get        : function (){ return cloneDeep(typeof this.$posSize === \"function\" ? this.$posSize() : this.$posSize) },\n  conflicts  : function (otherBlocks, selector){\n    return asArray(otherBlocks).reduce(function (red, block){\n      var selectOtherBlock = get(block, selector)\n                  \n      if(selectOtherBlock instanceof Block){\n        //다른 블럭이 현재 블럭과 같거나 space가 다를때는 평가하지 않음\n        if((selectOtherBlock === this) || (selectOtherBlock.$space != this.$space)) return red\n                      \n        //\n        var inspectResult = []\n                      \n        hashMap(this.get(), function (thisPos, key){\n          var otherPos = get(selectOtherBlock.get(), key)\n          if(otherPos[0] < thisPos[0] && (otherPos[0] + otherPos[1]) <= thisPos[0]) return inspectResult.push(false)\n          if(otherPos[0] > thisPos[0] && (thisPos[0] + thisPos[1]) <= otherPos[0]) return inspectResult.push(false)\n          return inspectResult.push(true)\n        })\n                      \n        if(inspectResult.length && !hasValueProperty(inspectResult, false)){\n          red.push(block)\n        }\n      }\n      return red\n    }.bind(this), [])\n  },\n  hasConflicts: function (otherBlocks, selector){ return !!this.conflicts(otherBlocks, selector).length },\n  overflow    : function (mask){\n    var blockPosSize  = this.get()\n    var spaceDomain   = this.$space.domain\n    var overflowDomain = (mask && cloneDeep(mask)) || (this.$space && this.$space.domain) || []\n    return hashMap(overflowDomain, function ($overflowSelected, sel){\n      var $posSize = get(blockPosSize, sel)\n      var $domain  = get(spaceDomain, sel)\n      return ($posSize[0] < get($overflowSelected[0], $domain[0]) || ($posSize[0] + $posSize[1]) > get($overflowSelected[1], $domain[1]))\n    })\n  },\n  isOverflow: function (mask){\n    var overflow = false\n    hashMap(this.overflow(mask), function (f){ if(f){ overflow = true } })\n    return overflow\n  },\n  maskOverflow  : function (mask){ return this.overflow(this.$mask || mask) },\n  isMaskOverflow: function (mask){ return this.isOverflow(this.$mask || mask) },\n  compute       : function (func){\n    if(typeof func === \"function\"){ \n      this.$compute = func \n    } else {\n      this.$compute && this.$compute(this.map())\n    } \n    return this \n  },\n  call: function (f){ typeof f === \"function\" && f.call(this, this.rangeMap) }\n})\n\nBlock.prototype = BlockPrototype \n      \nconst Tracker = function (space, domainMask){\n  this.$space = space\n  this.$domainMask = hashMap(cloneDeep(domainMask), function (mask, sel){\n    if(typeof mask === \"number\") mask = [mask]\n    if(mask instanceof Array){\n      if(!mask[0]) mask[0] = 0\n      if(!mask[1]) mask[1] = function (v){ return v }\n    }\n    return mask\n  })\n}\n      \nTracker.prototype = {\n  block: function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt) \n    block.$space = this.$space \n    block.$mask = this.$domainMask \n    return block\n  },\n  domainBlock: function (cursor, callback){\n    var domainGrid = hashMap(this.$space.range, function (range){ return range[2] })\n    var block      = this.block(hashMap(this.$space.rangeDomain(cursor), function (cursorPoint, key){ return [cursorPoint, get(domainGrid, key)] }))\n    var blockMap   = block.map()\n              \n    callback && callback.call(block, blockMap, block)\n    return block\n  }\n}\n      \nconst Space = function (domain, range){\n  this.$niceDomain = true\n  this.$niceRange = true\n  \n  Object.defineProperties(this, {\n    $niceDomain: { enumerable: false, writable: true, value: true },\n    $niceRange : { enumerable: false, writable: true, value: true },\n    $domain    : { enumerable: false, writable: true, value: undefined },\n    $range     : { enumerable: false, writable: true, value: undefined },\n    domain     : {\n      enumerable: true,\n      set (domain){\n        domain = hashMap(domain, function (domain){\n          if(!domain[2]){ domain[2] = 1 }\n          return domain\n        })\n        this.$domain = domain\n      },\n      get (){\n        return hashMap(cloneDeep(this.$domain), function (domain){\n          for(var i = 0, l = domain.length; i < l; i++) if(typeof domain[i] === \"function\") domain[i] = domain[i]()\n          return domain\n        })\n      }\n    },\n    range: {\n      enumerable: true,\n      set (range){\n        range = hashMap(range, function (range){\n          if(!range[2]){ range[2] = 1 }\n          return range\n        })\n        this.$range = range\n      },\n      get (){\n        return hashMap(cloneDeep(this.$range), function (range){\n          for(var i = 0, l = range.length; i < l; i++) if(typeof range[i] === \"function\") range[i] = range[i]()\n          return range\n        })\n      }\n    }\n  })\n  \n  this.$domain = domain\n  this.$range = range\n}\n      \nSpace.prototype = {\n  domainRangeSize: function (vs){\n    return hashMap(vs, function (v, sel){\n      var $range  = sel ? this.range[sel] : this.range\n      var $domain = sel ? this.domain[sel] : this.domain\n      return (v / ($domain[1] - $domain[0])) * ($range[1] - $range[0])\n    }.bind(this))\n  },\n  domainRange: function (vs){ return domainRangeValue(this.domain, this.range, vs, this.$niceRange) },\n  rangeDomain: function (vs){ return domainRangeValue(this.range, this.domain, vs, this.$niceDomain) },\n  block      : function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt)\n    block.$space = this\n    return block\n  },\n  tracker: function (domainMask){\n    var tracker = new Tracker(this, domainMask)\n    return tracker\n  }\n}\n      \nexport const space = (function (){\n  return function (domain, range){\n    return new Space(domain, range)\n  }\n}())\n  \nexport const block = (function (){\n  return function (posSize, syncOpt){\n    return new Block(posSize, syncOpt)\n  }\n}())\n"],"file":"block.js"}