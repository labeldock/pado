{"version":3,"sources":["../.src/modules/block.js"],"names":["hasValueProperty","obj","value","key","arguments","length","i","l","Block","posSize","syncOpt","Object","defineProperties","$space","enumerable","writable","undefined","$posSize","$mask","$compute","$sync","sync","prototype","block","console","log","clone","setPosition","sel","Array","setSize","get","domainValue","domainSize","domainMap","start","size","end","conflicts","otherBlocks","selector","reduce","red","selectOtherBlock","inspectResult","thisPos","otherPos","push","bind","hasConflicts","overflow","mask","blockPosSize","spaceDomain","getDomain","overflowDomain","$overflowSelected","$domain","isOverflow","f","maskOverflow","isMaskOverflow","rangeStart","domainRange","rangeSize","domainRangeSize","rangeMap","$start","$size","map","blockMap","rangeEnd","$domainMap","domainStart","domainEnd","compute","func","call","Tracker","space","domainMask","$domainMask","v","domainBlock","cursor","callback","domainGrid","getRange","range","rangeDomain","cursorPoint","Space","domain","$niceDomain","$niceRange","$range","set","vs","tracker"],"mappings":"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","sourcesContent":["import {\n  get,\n  hashMap,\n  domainRangeValue\n} from '../functions'\n\nimport {\n  isArray,\n  likeObject,\n  isEmpty\n} from '../functions/isLike'\n\nimport {\n  asArray,\n  cloneDeep as _cloneDeep\n} from '../functions/cast'\n\n// ?\nconst hasValueProperty = function (obj, value, key){\n  if(arguments.length == 1 && likeObject(obj)) return isEmpty(obj)\n  if(isArray(obj)) for(var i = 0, l = obj.length; i < l; i++) if(obj[i] === value) return true\n  if(likeObject(obj)){\n    if(key){\n      return get(obj, key) === value\n    } else {\n      for(var key in obj) if(get(obj, key) === value) return true\n    }\n  }\n  return false\n}\n\n\n//Scale foundation\n//정의역과 치역을 계산하여 결과값을 리턴함, 속성별로 정의하여 다중 차원 지원\n\nconst Block = function (posSize, syncOpt){\n  Object.defineProperties(this, {\n    $space  : { enumerable: false, writable: true, value: undefined },\n    $posSize: { enumerable: false, writable: true, value: undefined },\n    $mask   : { enumerable: false, writable: true, value: undefined },\n    $compute: { enumerable: false, writable: true, value: undefined },\n    $sync   : { enumerable: false, writable: true, value: undefined }\n  })\n  \n  this.sync(posSize, syncOpt)\n}\n  \nBlock.prototype = {\n  sync: function (block, syncOpt){ \n    console.log('sync1')\n    if(!arguments.length && this.$sync){\n      block = this.$sync()\n    } else if(typeof block === \"function\"){\n      this.$sync = block\n      if(syncOpt == true){\n        block = this.$sync()\n      } else {\n        return this\n      }\n    }\n    console.log('sync2', block)\n    if(block instanceof Block){ \n      this.$posSize = _cloneDeep(block.$posSize)\n      //.. this.$sync    = this.$sync || block.$sync\n      this.$space = this.$space || block.$space \n      this.$mask = this.$mask || block.$mask \n    } else {\n      this.$posSize = hashMap(_cloneDeep(block), function (posSize){ return !isArray(posSize) ? [posSize, 0] : posSize })\n    }\n    console.log('sync3')\n    return this \n  },\n  clone      : function (){ return new Block(this) },\n  setPosition: function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[0] = value; return this },\n  setSize    : function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[1] = value; return this },\n  get        : function (){ return _cloneDeep(typeof this.$posSize === \"function\" ? this.$posSize() : this.$posSize) },\n  domainValue: function (){ return hashMap(_cloneDeep(this.get()), function (posSize){ return posSize[0] }) },\n  domainSize : function (){ return hashMap(_cloneDeep(this.get()), function (posSize){ return posSize[1] }) },\n  domainMap  : function (){\n    return hashMap(_cloneDeep(this.get()), function (posSize){\n      return {\n        start: posSize[0],\n        size : posSize[1],\n        end  : posSize[0] + posSize[1]\n      }\n    })\n  },\n  conflicts: function (otherBlocks, selector){\n    return asArray(otherBlocks).reduce(function (red, block){\n      var selectOtherBlock = get(block, selector)\n                  \n      if(selectOtherBlock instanceof Block){\n        //다른 블럭이 현재 블럭과 같거나 space가 다를때는 평가하지 않음\n        if((selectOtherBlock === this) || (selectOtherBlock.$space != this.$space)) return red\n                      \n        //\n        var inspectResult = []\n                      \n        hashMap(this.get(), function (thisPos, key){\n          var otherPos = get(selectOtherBlock.get(), key)\n          if(otherPos[0] < thisPos[0] && (otherPos[0] + otherPos[1]) <= thisPos[0]) return inspectResult.push(false)\n          if(otherPos[0] > thisPos[0] && (thisPos[0] + thisPos[1]) <= otherPos[0]) return inspectResult.push(false)\n          return inspectResult.push(true)\n        })\n                      \n        if(inspectResult.length && !hasValueProperty(inspectResult, false)){\n          red.push(block)\n        }\n      }\n      return red\n    }.bind(this), [])\n  },\n  hasConflicts: function (otherBlocks, selector){ return !!this.conflicts(otherBlocks, selector).length },\n  overflow    : function (mask){\n    var blockPosSize  = this.get()\n    var spaceDomain   = this.$space.getDomain()\n    var overflowDomain = (mask && _cloneDeep(mask)) || (this.$space && this.$space.getDomain()) || []\n    return hashMap(overflowDomain, function ($overflowSelected, sel){\n      var $posSize = get(blockPosSize, sel)\n      var $domain  = get(spaceDomain, sel)\n      return ($posSize[0] < get($overflowSelected[0], $domain[0]) || ($posSize[0] + $posSize[1]) > get($overflowSelected[1], $domain[1]))\n    })\n  },\n  isOverflow: function (mask){\n    var overflow = false\n    hashMap(this.overflow(mask), function (f){ if(f){ overflow = true } })\n    return overflow\n  },\n  maskOverflow  : function (mask){ return this.overflow(this.$mask || mask) },\n  isMaskOverflow: function (mask){ return this.isOverflow(this.$mask || mask) },\n  rangeStart    : function (){ return this.$space.domainRange(hashMap(this.get(), function (posSize){ return posSize[0] })) },\n  rangeSize     : function (){ return this.$space.domainRangeSize(hashMap(this.get(), function (posSize){ return posSize[1] })) },\n  rangeMap      : function (){\n    var rangeSize = this.rangeSize()\n              \n    return hashMap(this.rangeStart(), function ($start, sel){ \n      var $size = sel ? rangeSize[sel] : rangeSize\n      return {\n        start: $start,\n        size : $size,\n        end  : $start + $size\n      }\n    })\n  },\n  map: function (){\n    var domainMap  = this.domainMap()\n    var rangeMap = this.rangeMap()\n              \n    var blockMap = hashMap(rangeMap, function (map, key){\n      map.rangeStart = map.start\n      map.rangeSize = map.size\n      map.rangeEnd = map.end\n                  \n      var $domainMap  = get(domainMap, key)\n      map.domainStart = $domainMap.start\n      map.domainSize = $domainMap.size\n      map.domainEnd = $domainMap.end\n      \n      delete map.start\n      delete map.size\n      delete map.end\n      return map\n    })\n              \n    return blockMap\n  },\n  rangeEnd: function (){ return this.rangeMap(this.rangeMap(), function (map){ return map.end }) },\n  compute : function (func){\n    if(typeof func === \"function\"){ \n      this.$compute = func \n    } else {\n      this.$compute && this.$compute(this.map())\n    } \n    return this \n  },\n  call: function (f){ typeof f === \"function\" && f.call(this, this.rangeMap()) }\n}\n      \nconst Tracker = function (space, domainMask){\n  this.$space = space\n  this.$domainMask = hashMap(_cloneDeep(domainMask), function (mask, sel){\n    if(typeof mask === \"number\") mask = [mask]\n    if(mask instanceof Array){\n      if(!mask[0]) mask[0] = 0\n      if(!mask[1]) mask[1] = function (v){ return v }\n    }\n    return mask\n  })\n}\n      \nTracker.prototype = {\n  block: function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt) \n    block.$space = this.$space \n    block.$mask = this.$domainMask \n    return block\n  },\n  domainBlock: function (cursor, callback){\n    var domainGrid = hashMap(this.$space.getRange(), function (range){ return range[2] })\n    var block      = this.block(hashMap(this.$space.rangeDomain(cursor), function (cursorPoint, key){ return [cursorPoint, get(domainGrid, key)] }))\n    var blockMap   = block.map()\n              \n    callback && callback.call(block, blockMap, block)\n    return block\n  }\n}\n      \nconst Space = function (domain, range){\n  this.$niceDomain = true\n  this.$niceRange = true\n  \n  Object.defineProperties(this, {\n    $niceDomain: { enumerable: false, writable: true, value: true },\n    $niceRange : { enumerable: false, writable: true, value: true },\n    $domain    : { enumerable: false, writable: true, value: undefined },\n    $range     : { enumerable: false, writable: true, value: undefined },\n    domain     : {\n      set (domain){\n        domain = hashMap(domain, function (domain){\n          if(!domain[2]){ domain[2] = 1 }\n          return domain\n        })\n        this.$domain = domain\n      },\n      get (){\n        return hashMap(_cloneDeep(this.$domain), function (domain){\n          for(var i = 0, l = domain.length; i < l; i++) if(typeof domain[i] === \"function\") domain[i] = domain[i]()\n          return domain\n        })\n      }\n    },\n    range: {\n      set (range){\n        range = hashMap(range, function (range){\n          if(!range[2]){ range[2] = 1 }\n          return range\n        })\n        this.$range = range\n      },\n      get (){\n        return hashMap(_cloneDeep(this.$range), function (range){\n          for(var i = 0, l = range.length; i < l; i++) if(typeof range[i] === \"function\") range[i] = range[i]()\n          return range\n        })\n      }\n    }\n  })\n  \n  this.$domain = domain\n  this.$range = range\n}\n      \nSpace.prototype = {\n  domainRangeSize: function (vs){\n    return hashMap(vs, function (v, sel){\n      var $range  = sel ? this.getRange()[sel] : this.getRange()\n      var $domain = sel ? this.getDomain()[sel] : this.getDomain()\n      return (v / ($domain[1] - $domain[0])) * ($range[1] - $range[0])\n    }.bind(this))\n  },\n  domainRange: function (vs){ return domainRangeValue(this.getDomain(), this.getRange(), vs, this.$niceRange) },\n  rangeDomain: function (vs){ return domainRangeValue(this.getRange(), this.getDomain(), vs, this.$niceDomain) },\n  block      : function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt)\n    block.$space = this\n    return block\n  },\n  tracker: function (domainMask){\n    var tracker = new Tracker(this, domainMask)\n    return tracker\n  }\n}\n      \nexport const space = (function (){\n  return function (domain, range){\n    return new Space(domain, range)\n  }\n}())\n  \nexport const block = (function (){\n  return function (posSize, syncOpt){\n    return new Block(posSize, syncOpt)\n  }\n}())\n"],"file":"block.js"}