{"version":3,"sources":["../.src/modules/block.js"],"names":["hasValueProperty","obj","value","key","arguments","length","likeObject","isEmpty","isArray","i","l","Block","posSize","syncOpt","$space","$posSize","$mask","$compute","$sync","sync","prototype","block","_cloneDeep","_","clone","setPosition","sel","Array","setSize","get","domainValue","domainSize","domainMap","start","size","end","conflicts","otherBlocks","selector","reduce","red","selectOtherBlock","inspectResult","thisPos","otherPos","push","bind","hasConflicts","overflow","mask","blockPosSize","spaceDomain","getDomain","overflowDomain","$overflowSelected","$domain","isOverflow","f","maskOverflow","isMaskOverflow","rangeStart","domainRange","rangeSize","domainRangeSize","rangeMap","$start","$size","map","blockMap","rangeEnd","$domainMap","domainStart","domainEnd","compute","func","call","Tracker","space","domainMask","$domainMask","v","domainBlock","cursor","callback","domainGrid","getRange","range","rangeDomain","cursorPoint","Space","domain","$niceDomain","$niceRange","$range","vs","tracker"],"mappings":"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","sourcesContent":["import {\n  asArray,\n  get,\n  cloneDeep,\n  forMap,\n  domainRangeValue\n} from '../functions'\n\n// ?\nconst hasValueProperty = function (obj, value, key){\n  if(arguments.length == 1 && likeObject(obj)) return isEmpty(obj)\n  if(isArray(obj)) for(var i = 0, l = obj.length; i < l; i++) if(obj[i] === value) return true\n  if(likeObject(obj)){\n    if(key){\n      return get(obj, key) === value\n    } else {\n      for(var key in obj) if(get(obj, key) === value) return true\n    }\n  }\n  return false\n}\n\n\n//Scale foundation\n//정의역과 치역을 계산하여 결과값을 리턴함, 속성별로 정의하여 다중 차원 지원\n\nconst Block = function (posSize, syncOpt){\n  this.$space = (void 0)\n  this.$posSize\n  this.$mask\n          \n  this.$compute\n  this.$sync\n  this.sync(posSize, syncOpt)\n}\n  \nBlock.prototype = {\n  sync: function (block, syncOpt){ \n    if(!arguments.length && this.$sync){\n      block = this.$sync()\n    } else if(typeof block === \"function\"){\n      this.$sync = block\n      if(syncOpt == true){\n        block = this.$sync()\n      } else {\n        return this\n      }\n    }\n    if(block instanceof Block){ \n      this.$posSize = _cloneDeep(block.$posSize)\n      //.. this.$sync    = this.$sync || block.$sync\n      this.$space = this.$space || block.$space \n      this.$mask = this.$mask || block.$mask \n    } else {\n      this.$posSize = forMap(_cloneDeep(block), function (posSize){ return !_.isArray(posSize) ? [posSize, 0] : posSize })\n    }\n    return this \n  },\n  clone      : function (){ return new Block(this) },\n  setPosition: function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[0] = value; return this },\n  setSize    : function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[1] = value; return this },\n  get        : function (){ return _cloneDeep(typeof this.$posSize === \"function\" ? this.$posSize() : this.$posSize) },\n  domainValue: function (){ return forMap(_cloneDeep(this.get()), function (posSize){ return posSize[0] }) },\n  domainSize : function (){ return forMap(_cloneDeep(this.get()), function (posSize){ return posSize[1] }) },\n  domainMap  : function (){\n    return forMap(_cloneDeep(this.get()), function (posSize){\n      return {\n        start: posSize[0],\n        size : posSize[1],\n        end  : posSize[0] + posSize[1]\n      }\n    })\n  },\n  conflicts: function (otherBlocks, selector){\n    return asArray(otherBlocks).reduce(function (red, block){\n      var selectOtherBlock = get(block, selector)\n                  \n      if(selectOtherBlock instanceof Block){\n        //다른 블럭이 현재 블럭과 같거나 space가 다를때는 평가하지 않음\n        if((selectOtherBlock === this) || (selectOtherBlock.$space != this.$space)) return red\n                      \n        //\n        var inspectResult = []\n                      \n        forMap(this.get(), function (thisPos, key){\n          var otherPos = get(selectOtherBlock.get(), key)\n          if(otherPos[0] < thisPos[0] && (otherPos[0] + otherPos[1]) <= thisPos[0]) return inspectResult.push(false)\n          if(otherPos[0] > thisPos[0] && (thisPos[0] + thisPos[1]) <= otherPos[0]) return inspectResult.push(false)\n          return inspectResult.push(true)\n        })\n                      \n        if(inspectResult.length && !hasValueProperty(inspectResult, false)){\n          red.push(block)\n        }\n      }\n      return red\n    }.bind(this), [])\n  },\n  hasConflicts: function (otherBlocks, selector){ return !!this.conflicts(otherBlocks, selector).length },\n  overflow    : function (mask){\n    var blockPosSize  = this.get()\n    var spaceDomain   = this.$space.getDomain()\n    var overflowDomain = (mask && _cloneDeep(mask)) || (this.$space && this.$space.getDomain()) || []\n    return forMap(overflowDomain, function ($overflowSelected, sel){\n      var $posSize = get(blockPosSize, sel)\n      var $domain  = get(spaceDomain, sel)\n      return ($posSize[0] < get($overflowSelected[0], $domain[0]) || ($posSize[0] + $posSize[1]) > get($overflowSelected[1], $domain[1]))\n    })\n  },\n  isOverflow: function (mask){\n    var overflow = false\n    forMap(this.overflow(mask), function (f){ if(f){ overflow = true } })\n    return overflow\n  },\n  maskOverflow  : function (mask){ return this.overflow(this.$mask || mask) },\n  isMaskOverflow: function (mask){ return this.isOverflow(this.$mask || mask) },\n  rangeStart    : function (){ return this.$space.domainRange(forMap(this.get(), function (posSize){ return posSize[0] })) },\n  rangeSize     : function (){ return this.$space.domainRangeSize(forMap(this.get(), function (posSize){ return posSize[1] })) },\n  rangeMap      : function (){\n    var rangeSize = this.rangeSize()\n              \n    return forMap(this.rangeStart(), function ($start, sel){ \n      var $size = sel ? rangeSize[sel] : rangeSize\n      return {\n        start: $start,\n        size : $size,\n        end  : $start + $size\n      }\n    })\n  },\n  map: function (){\n    var domainMap  = this.domainMap()\n    var rangeMap = this.rangeMap()\n              \n    var blockMap = forMap(rangeMap, function (map, key){\n      map.rangeStart = map.start,\n      map.rangeSize = map.size,\n      map.rangeEnd = map.end\n                  \n      var $domainMap  = get(domainMap, key)\n      map.domainStart = $domainMap.start,\n      map.domainSize = $domainMap.size,\n      map.domainEnd = $domainMap.end\n      delete map.start\n      delete map.size\n      delete map.end\n      return map\n    })\n              \n    return blockMap\n  },\n  rangeEnd: function (){ return this.rangeMap(this.rangeMap(), function (map){ return map.end }) },\n  compute : function (func){\n    if(typeof func === \"function\"){ \n      this.$compute = func \n    } else {\n      this.$compute && this.$compute(this.map())\n    } \n    return this \n  },\n  call: function (f){ typeof f === \"function\" && f.call(this, this.rangeMap()) }\n}\n      \nconst Tracker = function (space, domainMask){\n  this.$space = space\n  this.$domainMask = forMap(_cloneDeep(domainMask), function (mask, sel){\n    if(typeof mask === \"number\") mask = [mask]\n    if(mask instanceof Array){\n      if(!mask[0]) mask[0] = 0\n      if(!mask[1]) mask[1] = function (v){ return v }\n    }\n    return mask\n  })\n}\n      \nTracker.prototype = {\n  block: function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt) \n    block.$space = this.$space \n    block.$mask = this.$domainMask \n    return block\n  },\n  domainBlock: function (cursor, callback){\n    var domainGrid = forMap(this.$space.getRange(), function (range){ return range[2] })\n    var block      = this.block(forMap(this.$space.rangeDomain(cursor), function (cursorPoint, key){ return [cursorPoint, get(domainGrid, key)] }))\n    var blockMap   = block.map()\n              \n    callback && callback.call(block, blockMap, block)\n    return block\n  }\n}\n      \nconst Space = function (domain, range){\n  this.domain(domain)\n  this.range(range)\n  this.$niceDomain = true\n  this.$niceRange = true\n}\n      \nSpace.prototype = {\n  domain: function (domain){\n    //default grid scale\n    domain = forMap(domain, function (domain){\n      if(!domain[2]){ domain[2] = 1 }\n      return domain\n    })\n    this.$domain = domain\n  },\n  range: function (range){\n    range = forMap(range, function (range){\n      if(!range[2]){ range[2] = 1 }\n      return range\n    })\n    this.$range = range\n  },\n  getRange: function (){\n    return forMap(_cloneDeep(this.$range), function (range){\n      for(var i = 0, l = range.length; i < l; i++) if(typeof range[i] === \"function\") range[i] = range[i]()\n      return range\n    })\n  },\n  getDomain: function (){\n    return forMap(_cloneDeep(this.$domain), function (domain){\n      for(var i = 0, l = domain.length; i < l; i++) if(typeof domain[i] === \"function\") domain[i] = domain[i]()\n      return domain\n    })\n  },\n  domainRangeSize: function (vs){\n    return forMap(vs, function (v, sel){\n      var $range  = sel ? this.getRange()[sel] : this.getRange()\n      var $domain = sel ? this.getDomain()[sel] : this.getDomain()\n      return (v / ($domain[1] - $domain[0])) * ($range[1] - $range[0])\n    }.bind(this))\n  },\n  domainRange: function (vs){ return domainRangeValue(this.getDomain(), this.getRange(), vs, this.$niceRange) },\n  rangeDomain: function (vs){ return domainRangeValue(this.getRange(), this.getDomain(), vs, this.$niceDomain) },\n  block      : function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt)\n    block.$space = this\n    return block\n  },\n  tracker: function (domainMask){\n    var tracker = new Tracker(this, domainMask)\n    return tracker\n  }\n}\n      \nexport const space = (function (){\n  return function (domain, range){\n    return new Space(domain, range)\n  }\n}())\n  \nexport const block = (function (){\n  return function (posSize, syncOpt){\n    return new Block(posSize, syncOpt)\n  }\n}())\n"],"file":"block.js"}