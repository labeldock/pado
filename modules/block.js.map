{"version":3,"sources":["../.src/src/modules/block.js"],"names":["hasValueProperty","obj","value","key","arguments","length","likeObject","isEmpty","isArray","i","l","Block","posSize","syncOpt","$space","$posSize","$mask","$compute","$sync","sync","prototype","block","_cloneDeep","_","clone","setPosition","sel","Array","setSize","get","domainValue","domainSize","domainMap","start","size","end","conflicts","otherBlocks","selector","reduce","red","selectOtherBlock","inspectResult","thisPos","otherPos","push","bind","hasConflicts","overflow","mask","blockPosSize","spaceDomain","getDomain","overflowDomain","$overflowSelected","$domain","isOverflow","f","maskOverflow","isMaskOverflow","rangeStart","domainRange","rangeSize","domainRangeSize","rangeMap","$start","$size","map","blockMap","rangeEnd","$domainMap","domainStart","domainEnd","compute","func","call","Tracker","space","domainMask","$domainMask","v","domainBlock","cursor","callback","domainGrid","getRange","range","rangeDomain","cursorPoint","Space","domain","$niceDomain","$niceRange","$range","vs","tracker"],"mappings":"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","sourcesContent":["import {\n  asArray,\n  get,\n  cloneDeep,\n  forMap,\n  domainRangeValue\n} from '../functions'\n\n// ?\nconst hasValueProperty = function(obj,value,key){\n  if(arguments.length == 1 && likeObject(obj)) return isEmpty(obj);\n  if(isArray(obj)) for(var i=0,l=obj.length;i<l;i++) if(obj[i] === value) return true;\n  if(likeObject(obj)){\n    if(key){\n      return get(obj,key) === value;\n    } else {\n      for(var key in obj) if(get(obj,key) === value) return true;\n    }\n  }\n  return false;\n};\n\n\n//Scale foundation\n//정의역과 치역을 계산하여 결과값을 리턴함, 속성별로 정의하여 다중 차원 지원\n\nconst Block = function(posSize,syncOpt){\n  this.$space = (void 0);\n  this.$posSize;\n  this.$mask;\n          \n  this.$compute;\n  this.$sync;\n  this.sync(posSize,syncOpt);\n};\n  \nBlock.prototype = {\n  sync:function(block,syncOpt){ \n    if(!arguments.length && this.$sync){\n      block = this.$sync();\n    } else if(typeof block === \"function\"){\n      this.$sync = block;\n      if(syncOpt == true){\n        block = this.$sync();\n      } else {\n        return this;\n      }\n    }\n    if(block instanceof Block){ \n      this.$posSize = _cloneDeep(block.$posSize);\n      //.. this.$sync    = this.$sync || block.$sync\n      this.$space   = this.$space || block.$space; \n      this.$mask    = this.$mask  || block.$mask; \n    } else {\n      this.$posSize = forMap(_cloneDeep(block),function(posSize){ return !_.isArray(posSize) ? [posSize, 0] : posSize; });\n    }\n    return this; \n  },\n  clone:function(){ return new Block(this); },\n  setPosition:function(value,sel){ var $posSize = get(this.$posSize,sel); if($posSize instanceof Array) $posSize[0] = value; return this;},\n  setSize:function(value,sel){ var $posSize = get(this.$posSize,sel); if($posSize instanceof Array) $posSize[1] = value; return this; },\n  get:function(){ return _cloneDeep(typeof this.$posSize === \"function\" ? this.$posSize() : this.$posSize); },\n  domainValue:function(){ return forMap(_cloneDeep(this.get()),function(posSize){return posSize[0];}); },\n  domainSize :function(){ return forMap(_cloneDeep(this.get()),function(posSize){return posSize[1];}); },\n  domainMap:function(){\n    return forMap(_cloneDeep(this.get()),function(posSize){\n      return {\n        start:posSize[0],\n        size:posSize[1],\n        end:posSize[0] + posSize[1]\n      };\n    });\n  },\n  conflicts:function(otherBlocks,selector){\n    return asArray(otherBlocks).reduce(function(red,block){\n      var selectOtherBlock = get(block,selector);\n                  \n      if(selectOtherBlock instanceof Block){\n        //다른 블럭이 현재 블럭과 같거나 space가 다를때는 평가하지 않음\n        if((selectOtherBlock === this) || (selectOtherBlock.$space != this.$space)) return red;\n                      \n        //\n        var inspectResult = [];\n                      \n        forMap(this.get(),function(thisPos,key){\n          var otherPos = get(selectOtherBlock.get(),key);\n          if(otherPos[0] < thisPos[0] && (otherPos[0] + otherPos[1]) <= thisPos[0]) return inspectResult.push(false);\n          if(otherPos[0] > thisPos[0] && (thisPos[0]  + thisPos[1])  <= otherPos[0]) return inspectResult.push(false);\n          return inspectResult.push(true);\n        });\n                      \n        if(inspectResult.length && !hasValueProperty(inspectResult,false)){\n          red.push(block);\n        }\n      }\n      return red;\n    }.bind(this),[]);\n  },\n  hasConflicts:function(otherBlocks,selector){ return !!this.conflicts(otherBlocks,selector).length; },\n  overflow:function(mask){\n    var blockPosSize  = this.get();\n    var spaceDomain   = this.$space.getDomain();\n    var overflowDomain = (mask && _cloneDeep(mask)) || (this.$space && this.$space.getDomain()) || [];\n    return forMap(overflowDomain,function($overflowSelected,sel){\n      var $posSize = get(blockPosSize,sel);\n      var $domain  = get(spaceDomain,sel);\n      return ( $posSize[0] < get($overflowSelected[0],$domain[0]) || ($posSize[0] + $posSize[1]) > get($overflowSelected[1],$domain[1]) );\n    });\n  },\n  isOverflow:function(mask){\n    var overflow = false;\n    forMap(this.overflow(mask),function(f){ if(f){ overflow = true; } });\n    return overflow;\n  },\n  maskOverflow:function(mask){ return this.overflow(this.$mask || mask); },\n  isMaskOverflow:function(mask){ return this.isOverflow(this.$mask || mask); },\n  rangeStart:function(){ return this.$space.domainRange(forMap(this.get(),function(posSize){ return posSize[0]; })); },\n  rangeSize:function(){ return this.$space.domainRangeSize(forMap(this.get(),function(posSize){ return posSize[1]; })); },\n  rangeMap:function(){\n    var rangeSize = this.rangeSize();\n              \n    return forMap(this.rangeStart(),function($start,sel){ \n      var $size = sel ? rangeSize[sel] : rangeSize;\n      return {\n        start:$start,\n        size:$size,\n        end:$start+$size\n      };\n    }.bind(this));\n  },\n  map:function(){\n    var domainMap  = this.domainMap();\n    var rangeMap = this.rangeMap();\n              \n    var blockMap = forMap(rangeMap,function(map,key){\n      map.rangeStart = map.start,\n      map.rangeSize  = map.size,\n      map.rangeEnd   = map.end;\n                  \n      var $domainMap  = get(domainMap,key);\n      map.domainStart = $domainMap.start,\n      map.domainSize  = $domainMap.size,\n      map.domainEnd   = $domainMap.end;\n      delete map.start;\n      delete map.size;\n      delete map.end;\n      return map;\n    });\n              \n    return blockMap;\n  },\n  rangeEnd:function(){ return this.rangeMap(this.rangeMap(),function(map){ return map.end; }); },\n  compute:function(func){\n    if(typeof func === \"function\"){ \n      this.$compute = func; \n    } else {\n      this.$compute && this.$compute(this.map());\n    } \n    return this; \n  },\n  call:function(f){ typeof f === \"function\" && f.call(this,this.rangeMap()); }\n};\n      \nconst Tracker = function(space,domainMask){\n  this.$space = space;\n  this.$domainMask = forMap(_cloneDeep(domainMask),function(mask,sel){\n    if(typeof mask === \"number\") mask = [mask];\n    if(mask instanceof Array){\n      if(!mask[0]) mask[0] = 0;\n      if(!mask[1]) mask[1] = function(v){return v;};\n    }\n    return mask;\n  });\n};\n      \nTracker.prototype = {\n  block:function(posSize,syncOpt){ var block = new Block(posSize,syncOpt); \n    block.$space = this.$space; \n    block.$mask  = this.$domainMask; \n    return block;\n  },\n  domainBlock:function(cursor,callback){\n    var domainGrid = forMap(this.$space.getRange(),function(range){ return range[2]; });\n    var block      = this.block(forMap(this.$space.rangeDomain(cursor),function(cursorPoint,key){ return [cursorPoint,get(domainGrid,key)]; }));\n    var blockMap   = block.map();\n              \n    callback && callback.call(block,blockMap,block);\n    return block;\n  }\n};\n      \nconst Space = function(domain,range){\n  this.domain(domain);\n  this.range(range);\n  this.$niceDomain = true;\n  this.$niceRange  = true;\n};\n      \nSpace.prototype = {\n  domain:function(domain){\n    //default grid scale\n    domain = forMap(domain,function(domain){\n      if(!domain[2]){ domain[2] = 1; }\n      return domain;\n    });\n    this.$domain = domain;\n  },\n  range:function(range){\n    range = forMap(range,function(range){\n      if(!range[2]){ range[2] = 1; }\n      return range;\n    });\n    this.$range = range;\n  },\n  getRange:function(){\n    return forMap(_cloneDeep(this.$range),function(range){\n      for(var i=0,l=range.length;i<l;i++) if(typeof range[i] === \"function\") range[i] = range[i]();\n      return range;\n    });\n  },\n  getDomain:function(){\n    return forMap(_cloneDeep(this.$domain),function(domain){\n      for(var i=0,l=domain.length;i<l;i++) if(typeof domain[i] === \"function\") domain[i] = domain[i]();\n      return domain;\n    });\n  },\n  domainRangeSize:function(vs){\n    return forMap(vs,function(v,sel){\n      var $range  = sel ? this.getRange()[sel]  : this.getRange();\n      var $domain = sel ? this.getDomain()[sel] : this.getDomain();\n      return (v / ($domain[1] - $domain[0])) * ($range[1] - $range[0]);\n    }.bind(this));\n  },\n  domainRange:function(vs){ return domainRangeValue(this.getDomain(),this.getRange(),vs,this.$niceRange); },\n  rangeDomain:function(vs){ return domainRangeValue(this.getRange(),this.getDomain(),vs,this.$niceDomain); },\n  block:function(posSize,syncOpt){\n    var block = new Block(posSize,syncOpt);\n    block.$space = this;\n    return block;\n  },\n  tracker:function(domainMask){\n    var tracker = new Tracker(this,domainMask);\n    return tracker;\n  }\n};\n      \nexport const space = (function(){\n  return function(domain,range){\n    return new Space(domain,range);\n  };\n}());\n  \nexport const block = (function(){\n  return function(posSize,syncOpt){\n    return new Block(posSize,syncOpt);\n  };\n}());"],"file":"block.js"}