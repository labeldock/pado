{"version":3,"sources":["../.src/modules/block.js"],"names":["hasValueProperty","obj","value","key","arguments","length","i","l","Block","posSize","syncOpt","Object","defineProperties","$space","enumerable","undefined","$posSize","$mask","$compute","$sync","sync","prototype","block","clone","setPosition","sel","Array","setSize","get","domainValue","domainSize","domainMap","start","size","end","conflicts","otherBlocks","selector","reduce","red","selectOtherBlock","inspectResult","thisPos","otherPos","push","bind","hasConflicts","overflow","mask","blockPosSize","spaceDomain","getDomain","overflowDomain","$overflowSelected","$domain","isOverflow","f","maskOverflow","isMaskOverflow","rangeStart","domainRange","rangeSize","domainRangeSize","rangeMap","$start","$size","map","blockMap","rangeEnd","$domainMap","domainStart","domainEnd","compute","func","call","Tracker","space","domainMask","$domainMask","v","domainBlock","cursor","callback","domainGrid","getRange","range","rangeDomain","cursorPoint","Space","domain","$niceDomain","$niceRange","$range","vs","tracker"],"mappings":"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","sourcesContent":["import {\n  get,\n  forMap,\n  domainRangeValue\n} from '../functions'\n\nimport {\n  isArray,\n  likeObject,\n  isEmpty\n} from '../functions/isLike'\n\nimport {\n  asArray,\n  cloneDeep as _cloneDeep\n} from '../functions/cast'\n\n// ?\nconst hasValueProperty = function (obj, value, key){\n  if(arguments.length == 1 && likeObject(obj)) return isEmpty(obj)\n  if(isArray(obj)) for(var i = 0, l = obj.length; i < l; i++) if(obj[i] === value) return true\n  if(likeObject(obj)){\n    if(key){\n      return get(obj, key) === value\n    } else {\n      for(var key in obj) if(get(obj, key) === value) return true\n    }\n  }\n  return false\n}\n\n\n//Scale foundation\n//정의역과 치역을 계산하여 결과값을 리턴함, 속성별로 정의하여 다중 차원 지원\n\nconst Block = function (posSize, syncOpt){\n  Object.defineProperties(this, {\n    $space  : { enumerable: false, value: undefined },\n    $posSize: { enumerable: false, value: undefined },\n    $mask   : { enumerable: false, value: undefined },\n    $compute: { enumerable: false, value: undefined },\n    $sync   : { enumerable: false, value: undefined }\n  })\n  \n  \n  this.sync(posSize, syncOpt)\n}\n  \nBlock.prototype = {\n  sync: function (block, syncOpt){ \n    if(!arguments.length && this.$sync){\n      block = this.$sync()\n    } else if(typeof block === \"function\"){\n      this.$sync = block\n      if(syncOpt == true){\n        block = this.$sync()\n      } else {\n        return this\n      }\n    }\n    if(block instanceof Block){ \n      this.$posSize = _cloneDeep(block.$posSize)\n      //.. this.$sync    = this.$sync || block.$sync\n      this.$space = this.$space || block.$space \n      this.$mask = this.$mask || block.$mask \n    } else {\n      this.$posSize = forMap(_cloneDeep(block), function (posSize){ return !isArray(posSize) ? [posSize, 0] : posSize })\n    }\n    return this \n  },\n  clone      : function (){ return new Block(this) },\n  setPosition: function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[0] = value; return this },\n  setSize    : function (value, sel){ var $posSize = get(this.$posSize, sel); if($posSize instanceof Array) $posSize[1] = value; return this },\n  get        : function (){ return _cloneDeep(typeof this.$posSize === \"function\" ? this.$posSize() : this.$posSize) },\n  domainValue: function (){ return forMap(_cloneDeep(this.get()), function (posSize){ return posSize[0] }) },\n  domainSize : function (){ return forMap(_cloneDeep(this.get()), function (posSize){ return posSize[1] }) },\n  domainMap  : function (){\n    return forMap(_cloneDeep(this.get()), function (posSize){\n      return {\n        start: posSize[0],\n        size : posSize[1],\n        end  : posSize[0] + posSize[1]\n      }\n    })\n  },\n  conflicts: function (otherBlocks, selector){\n    return asArray(otherBlocks).reduce(function (red, block){\n      var selectOtherBlock = get(block, selector)\n                  \n      if(selectOtherBlock instanceof Block){\n        //다른 블럭이 현재 블럭과 같거나 space가 다를때는 평가하지 않음\n        if((selectOtherBlock === this) || (selectOtherBlock.$space != this.$space)) return red\n                      \n        //\n        var inspectResult = []\n                      \n        forMap(this.get(), function (thisPos, key){\n          var otherPos = get(selectOtherBlock.get(), key)\n          if(otherPos[0] < thisPos[0] && (otherPos[0] + otherPos[1]) <= thisPos[0]) return inspectResult.push(false)\n          if(otherPos[0] > thisPos[0] && (thisPos[0] + thisPos[1]) <= otherPos[0]) return inspectResult.push(false)\n          return inspectResult.push(true)\n        })\n                      \n        if(inspectResult.length && !hasValueProperty(inspectResult, false)){\n          red.push(block)\n        }\n      }\n      return red\n    }.bind(this), [])\n  },\n  hasConflicts: function (otherBlocks, selector){ return !!this.conflicts(otherBlocks, selector).length },\n  overflow    : function (mask){\n    var blockPosSize  = this.get()\n    var spaceDomain   = this.$space.getDomain()\n    var overflowDomain = (mask && _cloneDeep(mask)) || (this.$space && this.$space.getDomain()) || []\n    return forMap(overflowDomain, function ($overflowSelected, sel){\n      var $posSize = get(blockPosSize, sel)\n      var $domain  = get(spaceDomain, sel)\n      return ($posSize[0] < get($overflowSelected[0], $domain[0]) || ($posSize[0] + $posSize[1]) > get($overflowSelected[1], $domain[1]))\n    })\n  },\n  isOverflow: function (mask){\n    var overflow = false\n    forMap(this.overflow(mask), function (f){ if(f){ overflow = true } })\n    return overflow\n  },\n  maskOverflow  : function (mask){ return this.overflow(this.$mask || mask) },\n  isMaskOverflow: function (mask){ return this.isOverflow(this.$mask || mask) },\n  rangeStart    : function (){ return this.$space.domainRange(forMap(this.get(), function (posSize){ return posSize[0] })) },\n  rangeSize     : function (){ return this.$space.domainRangeSize(forMap(this.get(), function (posSize){ return posSize[1] })) },\n  rangeMap      : function (){\n    var rangeSize = this.rangeSize()\n              \n    return forMap(this.rangeStart(), function ($start, sel){ \n      var $size = sel ? rangeSize[sel] : rangeSize\n      return {\n        start: $start,\n        size : $size,\n        end  : $start + $size\n      }\n    })\n  },\n  map: function (){\n    var domainMap  = this.domainMap()\n    var rangeMap = this.rangeMap()\n              \n    var blockMap = forMap(rangeMap, function (map, key){\n      map.rangeStart = map.start\n      map.rangeSize = map.size\n      map.rangeEnd = map.end\n                  \n      var $domainMap  = get(domainMap, key)\n      map.domainStart = $domainMap.start\n      map.domainSize = $domainMap.size\n      map.domainEnd = $domainMap.end\n      \n      delete map.start\n      delete map.size\n      delete map.end\n      return map\n    })\n              \n    return blockMap\n  },\n  rangeEnd: function (){ return this.rangeMap(this.rangeMap(), function (map){ return map.end }) },\n  compute : function (func){\n    if(typeof func === \"function\"){ \n      this.$compute = func \n    } else {\n      this.$compute && this.$compute(this.map())\n    } \n    return this \n  },\n  call: function (f){ typeof f === \"function\" && f.call(this, this.rangeMap()) }\n}\n      \nconst Tracker = function (space, domainMask){\n  this.$space = space\n  this.$domainMask = forMap(_cloneDeep(domainMask), function (mask, sel){\n    if(typeof mask === \"number\") mask = [mask]\n    if(mask instanceof Array){\n      if(!mask[0]) mask[0] = 0\n      if(!mask[1]) mask[1] = function (v){ return v }\n    }\n    return mask\n  })\n}\n      \nTracker.prototype = {\n  block: function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt) \n    block.$space = this.$space \n    block.$mask = this.$domainMask \n    return block\n  },\n  domainBlock: function (cursor, callback){\n    var domainGrid = forMap(this.$space.getRange(), function (range){ return range[2] })\n    var block      = this.block(forMap(this.$space.rangeDomain(cursor), function (cursorPoint, key){ return [cursorPoint, get(domainGrid, key)] }))\n    var blockMap   = block.map()\n              \n    callback && callback.call(block, blockMap, block)\n    return block\n  }\n}\n      \nconst Space = function (domain, range){\n  this.domain(domain)\n  this.range(range)\n  this.$niceDomain = true\n  this.$niceRange = true\n}\n      \nSpace.prototype = {\n  domain: function (domain){\n    //default grid scale\n    domain = forMap(domain, function (domain){\n      if(!domain[2]){ domain[2] = 1 }\n      return domain\n    })\n    this.$domain = domain\n  },\n  range: function (range){\n    range = forMap(range, function (range){\n      if(!range[2]){ range[2] = 1 }\n      return range\n    })\n    this.$range = range\n  },\n  getRange: function (){\n    return forMap(_cloneDeep(this.$range), function (range){\n      for(var i = 0, l = range.length; i < l; i++) if(typeof range[i] === \"function\") range[i] = range[i]()\n      return range\n    })\n  },\n  getDomain: function (){\n    return forMap(_cloneDeep(this.$domain), function (domain){\n      for(var i = 0, l = domain.length; i < l; i++) if(typeof domain[i] === \"function\") domain[i] = domain[i]()\n      return domain\n    })\n  },\n  domainRangeSize: function (vs){\n    return forMap(vs, function (v, sel){\n      var $range  = sel ? this.getRange()[sel] : this.getRange()\n      var $domain = sel ? this.getDomain()[sel] : this.getDomain()\n      return (v / ($domain[1] - $domain[0])) * ($range[1] - $range[0])\n    }.bind(this))\n  },\n  domainRange: function (vs){ return domainRangeValue(this.getDomain(), this.getRange(), vs, this.$niceRange) },\n  rangeDomain: function (vs){ return domainRangeValue(this.getRange(), this.getDomain(), vs, this.$niceDomain) },\n  block      : function (posSize, syncOpt){\n    var block = new Block(posSize, syncOpt)\n    block.$space = this\n    return block\n  },\n  tracker: function (domainMask){\n    var tracker = new Tracker(this, domainMask)\n    return tracker\n  }\n}\n      \nexport const space = (function (){\n  return function (domain, range){\n    return new Space(domain, range)\n  }\n}())\n  \nexport const block = (function (){\n  return function (posSize, syncOpt){\n    return new Block(posSize, syncOpt)\n  }\n}())\n"],"file":"block.js"}