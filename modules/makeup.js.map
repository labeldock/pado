{"version":3,"sources":["../packages/pado/modules/makeup.js"],"names":["awaitLeadOnly","func","$pending","args","resolve","reject","apply","then","catch","e","awaitCompose","funcArgs","composeFuncs","forEach","f","push","payload","iterator","d","i","l","length","doWhile","taskPayload","proc","value","done","call","nextPayload","next","watchChange","changeValue","watchman","newValue","countScope","$count","destOldValue","$setter","effect","$oldValue","Watchman","equalityLogic","undefined","$equalityLogic","prototype","setter","changeListeners","fn","change","watch"],"mappings":"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","sourcesContent":["import {\n  promise,\n  valueOf as _valueOf,\n  abort as _abort,\n  reject as _reject\n} from './promise'\n\nimport {\n  alloc,\n  asArray,\n  cloneDeep as _cloneDeep\n} from '../functions/cast'\n\nimport {\n  isEqual as _isEqual\n} from '../functions/isLike'\n\nexport const awaitLeadOnly = function (func){\n  return alloc(function (){\n    let $pending = false\n    return function (...args){\n      if($pending === true){\n        return _abort()\n      } else {\n        $pending = true\n        return promise((resolve, reject)=>{\n          return _valueOf(func.apply(this, args)).then(resolve).catch(reject)\n        })\n        .then(e=>{\n          $pending = false\n          return e\n        })\n        .catch(e=>{\n          $pending = false\n          return _reject(e)\n        })\n      }\n    }\n  })\n}\n\nexport const awaitCompose = function (funcArgs){\n  return alloc(function (){\n    const composeFuncs = []\n\n    asArray(funcArgs).forEach(f=>{ typeof f === \"function\" && composeFuncs.push(f) })\n\n    return function (payload){\n      return promise((resolve, reject)=>{\n        function * iterator (){\n          for(let d = composeFuncs, i = 0, l = d.length; i < l; i++){\n            yield d[i]\n          }\n        }\n\n        const doWhile = ({ value: proc, done }, taskPayload)=>{\n          if(done){\n            resolve(taskPayload)\n          } else {\n            _valueOf(proc.call(this, taskPayload))\n            .then(nextPayload=>{\n              doWhile(iterator.next(), nextPayload)\n            })\n            .catch(reject)\n          }\n        }\n\n        doWhile.apply(iterator.next(), payload)\n      })\n    }\n  })\n}\n\n/*\n  수동 watch로직 입니다.\n  let watcher = watchChange(newValue=>{ doSomething... })\n  watcher.change(\"newValue\")\n*/\nexport const watchChange = function (){\n  const changeValue = function (watchman, newValue){\n    const countScope   = watchman.$count\n    const destOldValue = _cloneDeep(newValue)\n    \n    watchman.$setter.forEach(effect=>{\n      effect(newValue, watchman.$oldValue, countScope)\n    })\n    \n    watchman.$oldValue = destOldValue\n  }\n  \n  var Watchman = function (equalityLogic){\n    this.$setter = []\n    this.$oldValue = undefined\n    this.$count = 0\n    this.$equalityLogic = equalityLogic\n  }\n  \n  Watchman.prototype = {\n    setter (changeListeners){\n      asArray(changeListeners).forEach(fn=>{\n        if(typeof fn === \"function\"){\n          this.$setter.push(fn)\n        }\n      })\n    },\n    change (newValue){\n      var newValue\n      if(this.$equalityLogic){\n        if(!_isEqual(this.$oldValue, newValue)){\n          changeValue(this, newValue)\n        }\n      } else {\n        if(this.$oldValue != newValue){\n          changeValue(this, newValue)\n        }\n      }\n    }\n  }\n  return function (effect, equalityLogic){\n    const watch = new Watchman(equalityLogic)\n    watch.setter(effect)\n    return watch\n  }\n}\n"],"file":"makeup.js"}