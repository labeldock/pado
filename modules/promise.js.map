{"version":3,"sources":["../.src/modules/promise.js"],"names":["PromiseClass","Promise","isMaybePromise","target","resolveFn","resolve","rejectFn","reject","PromiseFunction","fn","r","c","maybeAwaiter","then","catch","promise","all","timeout","time","setTimeout","valueOf","maybeQ","abortMessage","Object","defineProperty","get","abort","notifyConsole","undefined","console","warn","defer","arguments","wheel","tasks","option","Array","Error","length","some","e","finished","limit","parseInt","taskLength","wheelTick","resetScope","nextWheelTick","tick","value","tickScope","nowAction","isActiveFn","nextTickFn","passValue","next","isActive","Math","floor","thenStack","catchStack","deferReset","resetTick","stop","forEach","start","reset","wheelControls","push","promisify","asyncErrCallbackfn","argumentNames","slice","promisified","args","from","apply","concat","err","error","callbakArgs","reduce","dest","name","index","sequance","funcArray","opts","concurrent","Number","POSITIVE_INFINITY","interval","repeat","sequanceTaskEntries","fill","sequanceLength","sequanceComplete","sequanceReseult","sequanceOperator","output","entry","limitOutput","operate","input","result"],"mappings":"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","sourcesContent":["import { asArray, asObject, isNumber, turn, argumentNamesBy } from '../functions';\nimport { operate } from './operate';\n\nconst PromiseClass = Promise;\n\nconst isMaybePromise = (target)=>(typeof target === \"object\" && target !== null && typeof target['then'] === \"function\" && typeof target['catch'] === \"function\");\nconst resolveFn = PromiseClass.resolve;\nconst rejectFn = PromiseClass.reject;\n\nconst PromiseFunction = function(fn) { \n  return new PromiseClass((r,c)=>{\n    const maybeAwaiter = fn(r,c);\n    isMaybePromise(maybeAwaiter) && maybeAwaiter.then(r).catch(c);\n  });\n};\n\nexport const promise = PromiseFunction;\nexport const all     = PromiseFunction.all = Promise.all;\nexport const resolve = PromiseFunction.resolve = resolveFn;\nexport const reject  = PromiseFunction.reject = rejectFn;\nexport const timeout = PromiseFunction.timeout = function(fn,time){\n  if(typeof fn === \"number\"){\n    return PromiseFunction( resolve => setTimeout(() => resolve(time), fn) );\n  } else {\n    return PromiseFunction( resolve => setTimeout(() => resolve(typeof fn === \"function\" ? fn() : fn),time) );\n  }\n};\n\nexport const valueOf = PromiseFunction.valueOf = function(maybeQ){\n  return PromiseFunction(function(resolve,reject){\n    isMaybePromise(maybeQ) ?\n    maybeQ.then(resolve).catch(reject) :\n    resolve(maybeQ) ;\n  });\n};\n\nconst abortMessage = new (function() {\n  Object.defineProperty(this, \"message\", {\n    get: ()=>\":abort\"\n  });\n  Object.defineProperty(this, \"abort\", {\n    get: ()=>true\n  });\n})();\n\nexport const abort = PromiseFunction.abort = function(notifyConsole = undefined) {\n  return new PromiseClass((resolve, reject)=>{\n    if(notifyConsole === true) {\n      console.warn(\"abort promise\");\n    }\n    reject(abortMessage);\n  });\n};\n\nexport const defer = PromiseFunction.defer = function(){\n  var resolve, reject;\n  var promise = new PromiseClass(function() {\n    resolve = arguments[0];\n    reject = arguments[1];\n  });\n  return {\n    resolve: resolve,\n    reject: reject,\n    promise: promise\n  };\n};\n\nexport const wheel = PromiseFunction.wheel = function(tasks, option) {\n\n  if(!(tasks instanceof Array)) {\n    return PromiseFunction.reject(new Error(\"tasks must be array\"));\n  }\n\n  if(!tasks.length || !tasks.some(e=>typeof e === \"function\")) {\n    return PromiseFunction.reject(new Error(\"not found wheel executable\"));\n  }\n\n  if(!tasks.some(e=>(typeof e !== \"function\" || typeof e !== \"number\"))) {\n    return PromiseFunction.reject(new Error(\"wheel task only function or number executable\"));\n  }\n\n  if(typeof option !== \"object\") {\n    option = {};\n  }\n\n  let finished = false;\n  let defer;\n  const limit = (typeof option.limit === \"number\" && option.limit > 0) ? parseInt(option.limit, 10) : 10000;\n  const taskLength = tasks.length;\n  let wheelTick = 0;\n  let resetScope = 0;\n  const nextWheelTick = (tick, value, tickScope)=>{\n    const nowAction = tasks[turn(tick, taskLength, 1)];\n\n    const isActiveFn = ()=>{\n      return tickScope === resetScope;\n    };\n\n    const nextTickFn = passValue=>{\n      // if reset called\n      if(!isActiveFn()) return;\n      // if over tick\n      if(wheelTick > limit) {\n        return defer.reject(new Error(\"limit\"));\n      }\n      if(finished === false) {\n        nextWheelTick(wheelTick++, passValue, tickScope);\n      }\n    };\n\n    if(typeof nowAction === \"function\") {\n      nowAction(\n        {\n          value,\n          next    : nextTickFn,\n          isActive: isActiveFn,\n          resolve : defer.resolve,\n          reject  : defer.reject\n        },\n        Math.floor(tick / tasks.length),\n        tick\n      );\n    } else if(typeof nowAction === \"number\") {\n      setTimeout(()=>{ nextTickFn(value); }, nowAction);\n    }\n  };\n  \n  const thenStack  = [\n    e=>{\n      if(finished === null) return PromiseFunction.abort();\n      finished = true;\n      return e;\n    }\n  ];\n  const catchStack = [\n    e=>{\n      if(finished === null) return PromiseFunction.abort();\n      finished = true;\n      return PromiseFunction.reject(e);\n    }\n  ];\n  \n  const deferReset = (resetTick)=>{\n    defer && defer.stop();\n    //\n    defer = PromiseFunction.defer();\n    thenStack.forEach(fn=>defer.promise.then(fn));\n    catchStack.forEach(fn=>defer.promise.catch(fn));\n    \n    //\n    defer.stop = (resetTick)=>{\n      finished = null;\n      resetScope += 1;\n    };\n    \n    defer.start = (resetTick)=>{\n      if(finished === null) {\n        finished = false;\n        wheelTick = typeof resetTick === \"number\" ? resetTick : 0;\n        nextWheelTick(wheelTick++, option.value, resetScope);\n      }\n    };\n    //\n    defer.reset = deferReset;\n    //\n    finished = null;\n    defer.start(resetTick);\n  };\n  \n  deferReset(0);\n  \n  const wheelControls = {\n    ...defer,\n    then (fn){\n      defer.promise.then(fn);\n      thenStack.push(fn);\n      return wheelControls;\n    },\n    catch (fn){\n      defer.promise.catch(fn);\n      catchStack.push(fn);\n      return wheelControls;\n    }\n  };\n  \n  return wheelControls;\n}\n\nexport const promisify = PromiseFunction.promisify = function(asyncErrCallbackfn){\n  const argumentNames = argumentNamesBy(asyncErrCallbackfn).slice(1);\n  const promisified   = function(){\n    const args = Array.from(arguments);\n    return new Promise((resolve, reject)=>{\n      asyncErrCallbackfn.apply(this, args.concat(function (err) {\n        const [error, ...callbakArgs] = Array.from(arguments);\n        if (error) {\n          reject(error);\n        } else if (argumentNames.length && callbakArgs.length > 1) {\n          resolve(argumentNames.reduce((dest, name, index)=>{\n            dest[name] = callbakArgs[index];\n            return dest;\n          },{}));\n        } else {\n          resolve(callbakArgs[0]);\n        }\n      }));\n    });\n  };\n  return function(){\n    return promisified.apply(this,Array.from(arguments))\n  };\n}\n\nexport const sequance = PromiseFunction.sequance = function(funcArray, opts){\n  return PromiseFunction(function(resolve, reject){\n    const option = asObject(opts,\"concurrent\");\n      \n    if(option.concurrent === true){\n      option.concurrent = Number.POSITIVE_INFINITY;\n    } else if(!isNumber(option.concurrent) || option.concurrent < 1){\n      option.concurrent = 1;\n    }\n      \n    if(!isNumber(option.interval) || option.interval < -1){\n      option.interval = -1;\n    }\n      \n    if(!isNumber(option.repeat) || option.repeat < 1){\n      option.repeat = 1;\n    }\n      \n    //set task with repeat\n    const sequanceTaskEntries = Array(option.repeat)\n    .fill(asArray(funcArray))\n    .reduce((dest,tasks)=>{\n      tasks.forEach((fn,index)=>dest.push([index,fn]));\n      return dest;\n    },[]);\n      \n    const sequanceLength = sequanceTaskEntries.length;\n    let sequanceComplete = 0;\n    const sequanceReseult = Array(sequanceTaskEntries.length);\n      \n    const sequanceOperator = operate({\n      output:async ({ entry })=>{\n        if(option.interval > -1){\n          await PromiseFunction.timeout(option.interval);\n        }\n        return entry;\n      },\n      limitOutput:1\n    })\n    .operate({\n      concurrent:option.concurrent,\n      input:async ({ entry })=>{\n        const [index, fn] = entry;\n        entry.push(await fn());\n        return entry;\n      },\n      output:({ entry })=>{\n        const [index, fn, result] = entry;\n        sequanceReseult[index] = result;\n        sequanceComplete++;\n        if(sequanceComplete === sequanceLength){\n          resolve(sequanceReseult);\n        }\n      }\n    })\n    .concat(sequanceTaskEntries);\n  });\n};"],"file":"promise.js"}